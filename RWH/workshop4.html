<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Environmental Management Plan Feedback</title>

<style>
  :root{
    --duration: 0.7s;
    --ease: cubic-bezier(0.6, 0, 0.2, 1);
    --transition: transform var(--duration) var(--ease);

    /* Pink palette */
    --pink1:#ff3d9a;
    --pink2:#ff74c5;
    --pink3:#ffd1ea;
    --pink4:#ff55ad;

    --card: rgba(255,255,255,.92);
    --panel: #f3f4f6;
    --text: #111827;
    --muted:#6b7280;
    --grey:#d1d5db;

    /* ‚ú® Adjust this to move nav arrows up or down (50% = centered) */
    --nav-position: 70%;

    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
  }

  *{ box-sizing:border-box; }
  html, body { height:100%; margin:0; padding:0; }

  body{
    display:flex;
    justify-content:center;
    align-items:center;
    background:
      radial-gradient(1200px 800px at 20% 20%, rgba(255,255,255,.10), transparent 60%),
      radial-gradient(900px 700px at 80% 30%, rgba(255,255,255,.08), transparent 60%),
      linear-gradient(180deg, #1a0c22, #120818);
    overflow:hidden;
    color: white;
  }

  .goo-filter{ position:absolute; visibility:hidden; }

  /* Thank you (gif only) */
  #thankyou{
    display:none;
    position: fixed;
    inset: 0;
    z-index: 50;
    justify-content:center;
    align-items:center;
    padding: 16px;
  }
  #thankyou img{
    width: 100%;
    max-width: 440px;
    height: auto;
    display:block;
    border-radius: 18px;
  }

  /* App size */
  #app{
    display:grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
    width: min(92vw, 560px);
    height: min(92svh, 760px);
  }
  #app > section{
    margin: clamp(10px, 3.5vw, 28px);
    grid-area: 1 / 1;
  }

  section{
    display:grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
    transform-style: preserve-3d;
    perspective: 1100px;
  }
  section > *{ grid-area: 1 / 1; }

  .backgrounds{
    filter: url("#goo");
    pointer-events:none;
  }

  /* HORIZONTAL stack backgrounds */
  .background{
    border-radius: 18px;
    background-image: linear-gradient(to bottom, var(--primary), var(--secondary));
    transition: var(--transition);
    transform-origin: right center;
    transform: translateX(-90%) translateZ(-25vmin) rotateY(40deg);
  }
  .background::before{
    content:"";
    position:absolute;
    inset: 0;
    border-radius: 18px;
    background: linear-gradient(to bottom, rgba(18,8,24,.86), rgba(18,8,24,.96));
    opacity: .78;
    transition: opacity var(--duration) var(--ease);
  }
  .background[data-active]::before{ opacity: .06; }

  .background[data-active]{
    transform-origin: center center;
    transform: translateX(0) translateZ(0) rotateY(0deg);
    z-index: 3;
  }
  .background[data-active] ~ .background{
    z-index: -1;
    transform-origin: left center;
    transform: translateX(140%) translateZ(-25vmin) rotateY(-40deg);
  }
  .background[data-active] + .background{
    z-index: 1;
    transform: translateX(90%) translateZ(-25vmin) rotateY(-40deg);
  }

  /* Cards */
  .content .card{
    background: var(--card);
    color: var(--text);
    border-radius: 18px;
    padding: 18px;
    box-shadow: 0 18px 40px rgba(0,0,0,.35);

    transition: var(--transition);
    transition-property: transform, transform-origin, opacity, z-index;

    transform-origin: right center;
    transform: translateX(-90%) translateZ(-25vmin) rotateY(40deg);
    opacity: 0;

    max-height: 100%;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-gutter: stable both-edges;
  }

  .content .card[data-active]{
    transform-origin: center center;
    transform: translateX(0) translateZ(0) rotateY(0deg);
    z-index: 3;
    opacity: 1;
  }
  .content .card[data-active] ~ .card{
    z-index: -1;
    transform-origin: left center;
    transform: translateX(140%) translateZ(-25vmin) rotateY(-40deg);
    opacity: 0;
  }
  .content .card[data-active] + .card{
    z-index: 1;
    transform: translateX(90%) translateZ(-25vmin) rotateY(-40deg);
    opacity: .85;
  }

  /* Brand */
  .brand{
    display:flex;
    flex-direction: column;
    align-items:center;
    text-align:center;
    gap: 10px;
    margin-bottom: 10px;
  }
  .brand img{
    max-width: 150px;
    max-height: 110px;
    width:auto;
    height:auto;
    object-fit: contain;
    display:block;
  }
  .title{
    font-weight: 900;
    line-height: 1.15;
    font-size: 18px;
    margin: 0;
  }
  .muted{
    margin: 6px 0 0;
    color: var(--muted);
    font-size: 13px;
    line-height: 1.4;
  }
  .preamble{
    margin: 12px 0 0;
    font-size: 14px;
    line-height: 1.5;
    color: #374151;
  }

  label{
    display:block;
    font-weight: 900;
    margin: 14px 0 10px;
    line-height: 1.25;
  }

  input[type="text"], input[type="email"], textarea{
    width:100%;
    padding: 14px 14px;
    border-radius: 14px;
    border: 1px solid var(--grey);
    font-size: 16px;
    box-sizing: border-box;
    background:#fff;
  }
  textarea{ min-height: 110px; resize: vertical; }

  input[type="text"]:focus,
  input[type="email"]:focus,
  textarea:focus{
    outline:none;
    border-color: var(--pink1);
    box-shadow: 0 0 0 3px rgba(255,61,154,.25);
  }
  input, textarea, button{ -webkit-tap-highlight-color: rgba(255,61,154,.25); }

  /* ‚úÖ Always-visible option rows */
  .options{
    display:flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 8px;
  }
  .opt{
    display:flex;
    align-items:flex-start;
    gap: 10px;
    padding: 12px 12px;
    border-radius: 14px;
    border: 1px solid rgba(209,213,219,.95);
    background: rgba(255,255,255,.75);
    cursor:pointer;
    user-select:none;
  }
  .opt:active{ transform: translateY(1px); }
  .dot{
    width: 18px;
    height: 18px;
    border-radius: 999px;
    border: 2px solid #9ca3af;
    margin-top: 1px;
    flex: 0 0 auto;
    position: relative;
  }
  .opt.selected{
    border-color: rgba(255,61,154,.55);
    box-shadow: 0 0 0 3px rgba(255,61,154,.14);
    background: rgba(255,255,255,.9);
  }
  .opt.selected .dot{ border-color: var(--pink1); }
  .opt.selected .dot::after{
    content:"";
    position:absolute;
    inset: 3px;
    background: var(--pink1);
    border-radius: 999px;
  }
  .optText{
    font-weight: 850;
    line-height: 1.25;
    color: #111827;
  }
  .optSub{
    margin-top: 4px;
    font-size: 13px;
    color: #6b7280;
    line-height: 1.35;
    font-weight: 650;
  }

  /* Q1 face row */
  .faceRow{
    display:flex;
    align-items:center;
    gap: 12px;
    margin-top: 12px;
    padding: 12px;
    border-radius: 16px;
    background: #f3f4f6;
  }
  .emoji{
    font-size: 46px;
    line-height: 1;
    transition: transform .18s ease;
    flex: 0 0 auto;
  }
  .emoji.bump{ transform: scale(1.08); }
  .faceText{
    font-weight: 900;
    color: #111827;
    line-height: 1.25;
  }
  .faceMeta{
    margin-top: 2px;
    font-size: 13px;
    color: #6b7280;
    font-weight: 700;
  }

  /* Panel */
  .panel{
    padding: 12px;
    border-radius: 14px;
    background: var(--panel);
  }

  /* Row */
  .row{
    margin-top: 14px;
  }

  /* Toggle */
  .toggle{
    width: 100%;
    max-width: 280px;
    height: 52px;
    background: #e5e7eb;
    border-radius: 999px;
    padding: 6px;
    display:flex;
    gap: 6px;
    margin-top: 8px;
  }
  .toggle button{
    flex:1;
    border:0;
    border-radius: 999px;
    background: transparent;
    color:#111827;
    font-weight: 900;
    font-size: 16px;
    cursor:pointer;
    padding: 0;
  }
  .toggle button.active{
    background:#111827;
    color:#fff;
  }
  .hint{
    font-size: 13px;
    color:#6b7280;
    margin-top: 10px;
    line-height: 1.35;
    font-weight: 700;
  }

  .error{
    color:#b91c1c;
    font-size: 14px;
    margin-top: 10px;
    display:none;
    font-weight: 800;
  }

  /* Footer */
  .footer{
    position: fixed;
    left:0; right:0;
    bottom: 0;
    padding: 10px 14px calc(10px + env(safe-area-inset-bottom));
    text-align:center;
    color: rgba(255,255,255,.75);
    font-size: 12px;
    z-index: 20;
    pointer-events:none;
  }

  /* Actions */
  .actions{
    display:flex;
    gap: 10px;
    margin-top: 16px;
    position: sticky;
    bottom: 0;
    padding: 10px 0 8px;
  }
  .btn{
    border:0;
    border-radius: 14px;
    padding: 14px 16px;
    font-size: 16px;
    font-weight: 900;
    cursor:pointer;
  }
  .btn.primary{ background:#111827; color:#fff; flex:1; }
  .btn.secondary{ background:#e5e7eb; color:#111827; min-width: 120px; }
  .btn:disabled{ opacity: .65; cursor:not-allowed; }

  /* Nav arrows */
  .navDock{
    position: fixed;
    z-index: 40;
    top: var(--nav-position);
    transform: translateY(-50%);
    right: max(10px, env(safe-area-inset-right));
  }
  .navPill{
    display:flex;
    flex-direction: column;
    gap: 8px;
    padding: 8px;
    border-radius: 999px;
    background: rgba(0,0,0,.66);
    border: 1px solid rgba(255,255,255,.22);
    backdrop-filter: blur(10px);
    box-shadow: 0 12px 28px rgba(0,0,0,.35);
  }
  .navArrow{
    width: 52px;
    height: 52px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.24);
    background: rgba(255,255,255,.14);
    color: #fff;
    font-size: 24px;
    font-weight: 900;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    line-height: 1;
  }
  .navArrow:active{ transform: translateY(1px); }
  .navArrow:focus{
    outline:none;
    box-shadow: 0 0 0 3px rgba(255,61,154,.28);
  }
  .navArrow:disabled{ opacity: .40; cursor:not-allowed; }

  @media (min-width: 640px){
    .navDock{ right: calc((100vw - min(92vw, 560px))/2 - 14px); }
  }
  @media (max-width: 420px){
    .emoji{ font-size: 42px; }
    .navArrow{ width: 50px; height: 50px; font-size: 22px; }
  }
</style>
</head>

<body>
  <svg class="goo-filter" viewBox="0 0 1 1" aria-hidden="true">
    <filter id="goo">
      <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur"></feGaussianBlur>
      <feColorMatrix in="blur" mode="matrix"
        values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 50 -20" result="goo"></feColorMatrix>
    </filter>
  </svg>

  <!-- THANK YOU -->
  <div id="thankyou">
    <img alt=""
      src="https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExbXVxNjAyMWN6ZjcyYnNjbDR5aHM1YzRhbzhkZG1taGhsNTloZ253ZiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/VGuKJjZOHvbTUtFNPT/giphy.gif">
  </div>

  <!-- Nav arrows -->
  <div class="navDock" aria-label="Navigate form cards">
    <div class="navPill">
      <button class="navArrow" id="prevBtn" type="button" aria-label="Previous">‚Äπ</button>
      <button class="navArrow" id="nextBtn" type="button" aria-label="Next">‚Ä∫</button>
    </div>
  </div>

  <main id="app" aria-label="EMP feedback cards">
    <!-- Background stack -->
    <section class="backgrounds">
      <div class="background" style="--primary: var(--pink1); --secondary: var(--pink2);"></div>
      <div class="background" style="--primary: var(--pink2); --secondary: var(--pink3);"></div>
      <div class="background" style="--primary: var(--pink3); --secondary: var(--pink4);"></div>
      <div class="background" style="--primary: var(--pink4); --secondary: var(--pink1);"></div>
      <div class="background" style="--primary: var(--pink1); --secondary: var(--pink3);"></div>
    </section>

    <section class="content">
      <!-- Card 1 -->
      <article class="card" data-active="true" data-id="1">
        <header class="brand">
          <img src="https://i.imgur.com/iB983sa.png" alt="">
          <div>
<br>
<br>
            <p class="title">The Royal Women's Hospital</p>
            <p class="title">Environmental Management Plan Feedback</p>

        </header>
<br>
<hr>
<br>
        <p class="muted">
          We're refining the Environmental Management Plan and want your honest view on direction and focus areas.
          Tap one option per question. 
          If you choose to join the working group, we'll ask for your name and email so we can reach out.
        </p>
<br>
<br>
<hr>
      </article>

      <!-- Card 2: Q1 -->
      <article class="card" data-id="2">
        <label>Q1. How confident do you feel in the current direction of the Environmental Management Plan?</label>
<br>
        <div class="options" id="q1Options" role="radiogroup" aria-label="Q1 options">
          <div class="opt" role="radio" aria-checked="false" data-value="1" tabindex="0">
            <div class="dot" aria-hidden="true"></div>
            <div><div class="optText">üòû Not confident</div></div>
          </div>

          <div class="opt" role="radio" aria-checked="false" data-value="2" tabindex="0">
            <div class="dot" aria-hidden="true"></div>
            <div><div class="optText">üôÅ Low confidence</div></div>
          </div>

          <div class="opt selected" role="radio" aria-checked="true" data-value="3" tabindex="0">
            <div class="dot" aria-hidden="true"></div>
            <div><div class="optText">üòê Neutral</div></div>
          </div>

          <div class="opt" role="radio" aria-checked="false" data-value="4" tabindex="0">
            <div class="dot" aria-hidden="true"></div>
            <div><div class="optText">üôÇ Confident</div></div>
          </div>

          <div class="opt" role="radio" aria-checked="false" data-value="5" tabindex="0">
            <div class="dot" aria-hidden="true"></div>
            <div><div class="optText">üòÑ Very confident</div></div>
          </div>
        </div>
<br><br>
        <div class="faceRow" aria-live="polite" style="margin-top:14px;">
          <div id="q1Face" class="emoji" aria-hidden="true">üòê</div>
          <div>
            <div class="faceText" id="q1Text">Neutral</div>
          </div>
        </div>
      </article>

      <!-- Card 3: Q1 breakout -->
      <article class="card" data-id="3">
        <label for="q1Why">What's driving that confidence score?</label>
<br>
        <textarea id="q1Why" placeholder="A sentence or two is perfect..."></textarea>
        <p class="muted" style="margin-top:10px;">
          Share anything that influenced your confidence (what's working, what's unclear, risks, etc.)
        </p>
      </article>

      <!-- Card 4: Q2 -->
      <article class="card" data-id="4">
        <label>Q2. Which area gives you the most confidence?</label>
<br>
        <div class="options" id="q2Options" role="radiogroup" aria-label="Q2 options">
          <div class="opt selected" role="radio" aria-checked="true" data-value="Clarity of targets and direction" tabindex="0">
            <div class="dot" aria-hidden="true"></div>
            <div>
              <div class="optText">üéØ Clarity of targets and direction</div>
              <div class="optSub">Clear outcomes and direction.</div>
            </div>
          </div>

          <div class="opt" role="radio" aria-checked="false" data-value="Balance of impact, cost, effort, and time" tabindex="0">
            <div class="dot" aria-hidden="true"></div>
            <div>
              <div class="optText">‚öñÔ∏è Balance of impact, cost, effort, and time</div>
              <div class="optSub">Feels realistic and achievable.</div>
            </div>
          </div>

          <div class="opt" role="radio" aria-checked="false" data-value="Initiative prioritisation" tabindex="0">
            <div class="dot" aria-hidden="true"></div>
            <div>
              <div class="optText">üìã Initiative prioritisation</div>
              <div class="optSub">Right things first.</div>
            </div>
          </div>

          <div class="opt" role="radio" aria-checked="false" data-value="Delivery pathway and governance" tabindex="0">
            <div class="dot" aria-hidden="true"></div>
            <div>
              <div class="optText">üß≠ Delivery pathway and governance</div>
              <div class="optSub">Clear owners and milestones.</div> 
            </div>
          </div>

          <div class="opt" role="radio" aria-checked="false" data-value="Stakeholder involvement" tabindex="0">
            <div class="dot" aria-hidden="true"></div>
            <div>
              <div class="optText">ü§ùüèª Stakeholder involvement</div>
              <div class="optSub">Right people engaged.</div>
            </div>
          </div>
        </div>

        <div class="panel" style="margin-top:14px;">
          <div class="faceText">You Selected:</div>
          <div class="muted" id="q2SelectedText" style="margin-top:6px;">Clarity of targets and direction</div>
        </div>
      </article>

      <!-- Card 5: Working group -->
      <article class="card" data-id="5">
        <label>Do you want to be in the working group?</label>
<br>
        <div class="panel">
          <div style="display:flex; align-items:flex-start; gap:14px;">
            <div id="wgIcon" class="emoji" aria-hidden="true">üòå</div>

            <div style="flex:1; min-width:0;">
              <div class="toggle" role="group" aria-label="Working group yes or no">
                <button type="button" id="wgNo" class="active" aria-pressed="true">No</button>
                <button type="button" id="wgYes" aria-pressed="false">Yes</button>
              </div>
              <div class="hint" id="wgHint">All good ‚Äî no action needed.</div>
            </div>

            <!-- ‚úÖ hidden but keeps #wgValue for JS -->
            <div class="badge" style="display:none;" aria-hidden="true">
              Selected: <span id="wgValue">No</span>
            </div>
          </div>

          <div class="row" id="wgNameRow" style="display:none; margin-top:18px;">
            <label for="wgName">Name</label>
            <input id="wgName" type="text" placeholder="Your name" autocomplete="name" inputmode="text">
            <div class="error" id="errWGName">Please enter your name.</div>
          </div>

          <div class="row" id="wgContactRow" style="display:none; margin-top:18px;">
            <label for="wgEmail">Email address (so we can contact you)</label>
            <input id="wgEmail" type="email" placeholder="name@company.com" autocomplete="email" inputmode="email">
            <div class="error" id="errEmail">Please enter a valid email address.</div>
          </div>

          <div class="row" id="wgAreasRow" style="display:none; margin-top:18px;">
            <label for="wgAreas">Key areas you'd like to contribute to (optional)</label>
            <textarea id="wgAreas" placeholder="Type key areas you'd like to contribute to..."></textarea>
          </div>
        </div>
      </article>

      <!-- Card 6: Submit -->
      <article class="card" data-id="6">
        <p class="title" style="margin:0 0 6px;">Submit</p>
        <p class="muted" style="margin:0;">Press Submit to send your response.</p>
<br>
        <div class="actions">
          <button class="btn secondary" type="button" id="reviewBtn">Review</button>
          <button class="btn primary" type="button" id="submitBtn">Submit</button>
        </div>

        <div class="error" id="errSubmit" style="margin-top:12px;"></div>
      </article>
    </section>
  </main>

  <div class="footer">2026 | Shrunk Innovation Group | All Rights Reserved</div>

<script>
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwNocuTu1R50Ois2tclgihzrSjmIvWQ2ZFpMdTJ3sgkYuK5UhgMY6bZdb_VlVD26Ywm5A/exec";

  const elApp = document.querySelector("#app");
  const elBackgrounds = Array.from(document.querySelectorAll(".background"));
  const elCards = Array.from(document.querySelectorAll(".content .card"));

  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");

  let activeIndex = 0;

  function setActive(index){
    activeIndex = Math.max(0, Math.min(index, elCards.length - 1));
    elApp.querySelectorAll("[data-active]").forEach(el => el.removeAttribute("data-active"));

    elCards[activeIndex].setAttribute("data-active", "true");
    elBackgrounds[Math.min(activeIndex, elBackgrounds.length - 1)].setAttribute("data-active", "true");

    prevBtn.disabled = activeIndex === 0;
    nextBtn.disabled = activeIndex === elCards.length - 1;

    elCards[activeIndex].scrollTop = 0;
  }

  elCards.forEach((card) => {
    card.addEventListener("click", () => setActive(elCards.indexOf(card)));
  });

  prevBtn.addEventListener("click", (e)=>{ e.stopPropagation(); setActive(activeIndex - 1); });
  nextBtn.addEventListener("click", (e)=>{ e.stopPropagation(); setActive(activeIndex + 1); });

  window.addEventListener("keydown", (e)=>{
    if (e.key === "ArrowLeft") setActive(activeIndex - 1);
    if (e.key === "ArrowRight") setActive(activeIndex + 1);
  });

  function bump(el){
    el.classList.add("bump");
    setTimeout(()=>el.classList.remove("bump"), 140);
  }

  function setSelectedOption(container, selectedValue){
    const opts = Array.from(container.querySelectorAll(".opt"));
    opts.forEach(opt=>{
      const isSel = opt.dataset.value === selectedValue;
      opt.classList.toggle("selected", isSel);
      opt.setAttribute("aria-checked", String(isSel));
    });
  }

  function bindOptionGroup(container, getDefault, onChange){
    let selected = getDefault();
    setSelectedOption(container, selected);

    container.addEventListener("click", (e)=>{
      const opt = e.target.closest(".opt");
      if (!opt) return;
      selected = opt.dataset.value;
      setSelectedOption(container, selected);
      onChange(selected);
    });

    container.addEventListener("keydown", (e)=>{
      if (!(e.key === "Enter" || e.key === " ")) return;
      const opt = e.target.closest(".opt");
      if (!opt) return;
      e.preventDefault();
      selected = opt.dataset.value;
      setSelectedOption(container, selected);
      onChange(selected);
    });

    return () => selected;
  }

  // Q1
  const q1Face = document.getElementById("q1Face");
  const q1Text = document.getElementById("q1Text");

  const q1States = {
    "1": { face:"üòû", text:"Not confident" },
    "2": { face:"üôÅ", text:"Low confidence" },
    "3": { face:"üòê", text:"Neutral" },
    "4": { face:"üôÇ", text:"Confident" },
    "5": { face:"üòÑ", text:"Very confident" }
  };

  const getQ1 = bindOptionGroup(
    document.getElementById("q1Options"),
    () => "3",
    (val) => {
      q1Face.textContent = q1States[val].face;
      q1Text.textContent = q1States[val].text;
      bump(q1Face);
    }
  );
  q1Face.textContent = q1States[getQ1()].face;
  q1Text.textContent = q1States[getQ1()].text;

  const q1Why = document.getElementById("q1Why");

  // Q2
  const q2SelectedText = document.getElementById("q2SelectedText");
  const getQ2 = bindOptionGroup(
    document.getElementById("q2Options"),
    () => "Clarity of targets and direction",
    (val) => { q2SelectedText.textContent = val; }
  );
  q2SelectedText.textContent = getQ2();

  // Working group
  let workingGroup = "No";
  const wgNoBtn = document.getElementById("wgNo");
  const wgYesBtn = document.getElementById("wgYes");
  const wgIcon = document.getElementById("wgIcon");
  const wgValue = document.getElementById("wgValue");
  const wgHint = document.getElementById("wgHint");

  const wgNameRow = document.getElementById("wgNameRow");
  const wgName = document.getElementById("wgName");
  const errWGName = document.getElementById("errWGName");

  const wgContactRow = document.getElementById("wgContactRow");
  const wgEmail = document.getElementById("wgEmail");
  const errEmail = document.getElementById("errEmail");

  const wgAreasRow = document.getElementById("wgAreasRow");
  const wgAreas = document.getElementById("wgAreas");

  function isValidEmail(email){
    return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email.trim());
  }

  function setWG(value){
    workingGroup = value;
    const yes = value === "Yes";

    wgNoBtn.classList.toggle("active", !yes);
    wgYesBtn.classList.toggle("active", yes);
    wgNoBtn.setAttribute("aria-pressed", String(!yes));
    wgYesBtn.setAttribute("aria-pressed", String(yes));

    wgValue.textContent = value;

    if (yes){
      wgIcon.textContent = "üôã";
      wgHint.textContent = "Thanks! Add your name + email so we can contact you (areas optional).";
      wgNameRow.style.display = "block";
      wgContactRow.style.display = "block";
      wgAreasRow.style.display = "block";
    } else {
      wgIcon.textContent = "üòå";
      wgHint.textContent = "All good ‚Äî no action needed.";
      wgNameRow.style.display = "none";
      wgContactRow.style.display = "none";
      wgAreasRow.style.display = "none";
      errEmail.style.display = "none";
      errWGName.style.display = "none";
      wgName.value = "";
      wgEmail.value = "";
      wgAreas.value = "";
    }
    bump(wgIcon);
  }

  wgNoBtn.addEventListener("click", (e)=>{ e.stopPropagation(); setWG("No"); });
  wgYesBtn.addEventListener("click", (e)=>{ e.stopPropagation(); setWG("Yes"); });
  setWG("No");

  // Review
  document.getElementById("reviewBtn").addEventListener("click", (e)=>{
    e.stopPropagation();
    setActive(0);
  });

  // Submit
  const errSubmit = document.getElementById("errSubmit");
  const submitBtn = document.getElementById("submitBtn");
  const thankyou = document.getElementById("thankyou");

  function showThankYou(){
    elApp.style.display = "none";
    document.querySelector(".footer").style.display = "none";
    document.querySelector(".navDock").style.display = "none";
    thankyou.style.display = "flex";
  }

  submitBtn.addEventListener("click", async (e)=>{
    e.stopPropagation();
    errSubmit.style.display = "none";

    if (workingGroup === "Yes"){
      const name = wgName.value.trim();
      if (!name){
        errWGName.style.display = "block";
        setActive(4);
        wgName.focus({ preventScroll:true });
        return;
      }
      errWGName.style.display = "none";

      const email = wgEmail.value.trim();
      if (!isValidEmail(email)){
        errEmail.style.display = "block";
        setActive(4);
        wgEmail.focus({ preventScroll:true });
        return;
      }
      errEmail.style.display = "none";
    }

    const payload = {
      name: (workingGroup === "Yes") ? wgName.value.trim() : "",
      q1_confidence: getQ1(),
      q1_breakout: q1Why.value.trim(),
      q2_area: getQ2(),
      working_group: workingGroup,
      working_group_email: (workingGroup === "Yes") ? wgEmail.value.trim() : "",
      working_group_areas: (workingGroup === "Yes") ? wgAreas.value.trim() : ""
    };

    submitBtn.disabled = true;
    submitBtn.textContent = "Submitting...";

    try{
      const fd = new FormData();
      Object.entries(payload).forEach(([k,v]) => fd.append(k, v));
      await fetch(WEB_APP_URL, { method:"POST", mode:"no-cors", body: fd });
      showThankYou();
    } catch(err){
      errSubmit.textContent = "Submit failed: " + (err.message || err);
      errSubmit.style.display = "block";
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = "Submit";
    }
  });

  setActive(0);
</script>
</body>
</html>
