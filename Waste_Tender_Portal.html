<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shrunk Waste Tender Portal</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      height: 100%;
    }
    html {
      height: 100%;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .splash-accent {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    .card-shadow {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .tender-section {
      border-left: 4px solid #f5576c;
      padding-left: 1.5rem;
      margin-bottom: 2rem;
    }
    .site-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    .site-table th,
    .site-table td {
      border: 1px solid #e5e7eb;
      padding: 0.75rem;
      text-align: left;
    }
    .site-table th {
      background-color: #f9fafb;
      font-weight: 600;
      color: #374151;
    }
    .upload-zone {
      border: 2px dashed #d1d5db;
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .upload-zone:hover {
      border-color: #f5576c;
      background-color: #fef2f2;
    }
    .loading-spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #f5576c;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 0.5rem;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .tab-button {
      padding: 0.75rem 1.5rem;
      border-bottom: 3px solid transparent;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
      background: none;
      border-top: none;
      border-left: none;
      border-right: none;
    }
    .tab-button:hover {
      background-color: rgba(0,0,0,0.05);
    }
    .tab-button.active {
      border-bottom-color: #f5576c;
      color: #f5576c;
    }
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .photo-item {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
      background-color: #f9fafb;
      padding: 0.5rem;
    }
    .photo-item img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 4px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .photo-item img:hover {
      transform: scale(1.02);
    }
    .photo-placeholder {
      width: 100%;
      height: 200px;
      background-color: #e5e7eb;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      font-size: 0.875rem;
    }
    .photo-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 2rem;
    }
    .photo-modal img {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
      border-radius: 8px;
    }
    .photo-modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background-color: rgba(255, 255, 255, 0.9);
      color: #1f2937;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.5rem;
      font-weight: bold;
      transition: background-color 0.2s ease;
    }
    .photo-modal-close:hover {
      background-color: white;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body>
  <div id="app" class="w-full min-h-full"></div>
  <script>
    const defaultConfig = {
      portal_title: "Shrunk Waste Tender Portal",
      client_name: "Cedar Pacific",
      tender_title: "Request for Waste Services Quotation",
      contact_name: "Nick Twining â€“ Shrunk",
      contact_details: "M: 0418 854 628 | E: nick@shrunk.ai",
      webhook_url: "https://webhook.site/your-unique-id",
      primary_color: "#667eea",
      secondary_color: "#f5576c",
      background_color: "#f9fafb",
      text_color: "#1f2937",
      surface_color: "#ffffff"
    };

    let currentUser = null;
    let allVendors = [];
    let isLoading = false;
    let activeTab = "requirements";

    const sitePhotos = {
      "melbourne_cbd": [
        { url: "https://i.imgur.com/BteWMvZ.png", caption: "Building Entrance" },
        { url: "https://i.imgur.com/8uDbJhv.png", caption: "Waste Collection Area" }
      ],
      "melbourne_central": [
        { url: "https://i.imgur.com/7CJKzPR.png", caption: "Front Access" },
        { url: "https://i.imgur.com/7CJKzPR.png", caption: "Loading Dock" }
      ],
      "victoria_university": [
        { url: "https://i.imgur.com/krwtpkU.png", caption: "Site Overview" },
        { url: "https://i.imgur.com/XI9x0ct.png", caption: "Collection Point" },
        { url: "https://i.imgur.com/ISrH4Wl.png", caption: "Bin Area" }
      ],
      "kensington": [
        { url: "https://i.imgur.com/mUYtja3.png", caption: "Underground Access" },
        { url: "https://i.imgur.com/gUhXw4L.png", caption: "Waste Room" }
      ]
    };

    const dataHandler = {
      onDataChanged(data) {
        allVendors = data;
        if (currentUser) {
          const updated = data.find(v => v.id === currentUser.id);
          if (updated) {
            currentUser = updated;
          }
        }
        renderApp();
      }
    };

    async function initApp() {
      const result = await window.dataSdk.init(dataHandler);
      if (!result.isOk) {
        console.error("Failed to initialize Data SDK");
        return;
      }
      renderApp();
    }

    function renderApp() {
      const app = document.getElementById('app');
      
      if (!currentUser) {
        app.innerHTML = renderLoginPage();
      } else {
        app.innerHTML = renderTenderPortal();
      }
    }

    function renderLoginPage() {
      const config = window.elementSdk?.config || defaultConfig;
      return `
        <div class="w-full min-h-full" style="background-color: ${config.background_color};">
          <div class="gradient-bg w-full py-6">
            <div class="max-w-6xl mx-auto px-6">
              <h1 class="text-3xl font-bold text-white">${config.portal_title}</h1>
              <p class="text-white text-opacity-90 mt-1">Vendor Registration & Submission Portal</p>
            </div>
          </div>
          
          <div class="max-w-md mx-auto px-6 py-12">
            <div class="card-shadow rounded-lg p-8" style="background-color: ${config.surface_color};">
              <div class="text-center mb-6">
                <div class="splash-accent w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center">
                  <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                  </svg>
                </div>
                <h2 class="text-2xl font-bold" style="color: ${config.text_color};">Vendor Registration</h2>
                <p class="text-gray-600 mt-2">Register or login to access the tender</p>
              </div>

              <form id="registrationForm" onsubmit="handleRegistration(event)">
                <div class="mb-4">
                  <label for="email" class="block text-sm font-medium mb-2" style="color: ${config.text_color};">Email Address</label>
                  <input type="email" id="email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2" style="focus:ring-color: ${config.primary_color};" placeholder="your@email.com">
                  <p class="text-xs text-gray-500 mt-1">Enter your email to login or register</p>
                </div>

                <div id="additionalFields" style="display: none;">
                  <div class="mb-4">
                    <label for="companyName" class="block text-sm font-medium mb-2" style="color: ${config.text_color};">Company Name</label>
                    <input type="text" id="companyName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2" style="focus:ring-color: ${config.primary_color};">
                  </div>

                  <div class="mb-4">
                    <label for="contactName" class="block text-sm font-medium mb-2" style="color: ${config.text_color};">Contact Name</label>
                    <input type="text" id="contactName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2" style="focus:ring-color: ${config.primary_color};">
                  </div>

                  <div class="mb-4">
                    <label for="phone" class="block text-sm font-medium mb-2" style="color: ${config.text_color};">Phone Number</label>
                    <input type="tel" id="phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2" style="focus:ring-color: ${config.primary_color};">
                  </div>
                </div>

                <button type="submit" id="submitBtn" class="w-full text-white font-semibold py-3 rounded-lg transition-all" style="background-color: ${config.secondary_color};" onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'" ${isLoading ? 'disabled' : ''}>
                  ${isLoading ? '<span class="loading-spinner"></span>Checking...' : 'Continue'}
                </button>
              </form>
            </div>
          </div>
        </div>
      `;
    }

    function renderTenderPortal() {
      const config = window.elementSdk?.config || defaultConfig;
      const hasSubmitted = currentUser.submission_status === 'submitted';

      return `
        <div class="w-full min-h-full" style="background-color: ${config.background_color};">
          <div class="gradient-bg w-full py-6">
            <div class="max-w-6xl mx-auto px-6 flex justify-between items-center">
              <div>
                <h1 class="text-3xl font-bold text-white">${config.portal_title}</h1>
                <p class="text-white text-opacity-90 mt-1">${config.client_name} Waste Services Tender</p>
              </div>
              <button onclick="logout()" class="text-white bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all">
                Logout
              </button>
            </div>
          </div>

          <div class="max-w-6xl mx-auto px-6 py-8">
            <div class="card-shadow rounded-lg p-6 mb-6" style="background-color: ${config.surface_color};">
              <div class="flex items-center justify-between">
                <div>
                  <h2 class="text-xl font-bold" style="color: ${config.text_color};">Welcome, ${currentUser.company_name}</h2>
                  <p class="text-gray-600 mt-1">Contact: ${currentUser.contact_name} | ${currentUser.email}</p>
                </div>
                ${hasSubmitted ? `
                  <div class="flex items-center text-green-600">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="font-semibold">Submission Complete</span>
                  </div>
                ` : ''}
              </div>
              
              ${!hasSubmitted ? `
                <div class="mt-4 pt-4 border-t border-gray-200">
                  <h3 class="text-sm font-semibold mb-2" style="color: ${config.text_color};">ðŸ“‹ How to Submit Your Quotation:</h3>
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm text-gray-600">
                    <div class="flex items-start">
                      <span class="font-semibold mr-2" style="color: ${config.secondary_color};">1.</span>
                      <span><strong>Tender Requirements</strong> - Review all project details and service requirements</span>
                    </div>
                    <div class="flex items-start">
                      <span class="font-semibold mr-2" style="color: ${config.secondary_color};">2.</span>
                      <span><strong>Site Photos</strong> - View photos of all four collection sites</span>
                    </div>
                    <div class="flex items-start">
                      <span class="font-semibold mr-2" style="color: ${config.secondary_color};">3.</span>
                      <span><strong>Submit Quotation</strong> - Download the Excel template, complete it, and upload your quote</span>
                    </div>
                  </div>
                </div>
              ` : ''}
            </div>

            ${hasSubmitted ? renderSubmissionConfirmation(config) : renderTenderContentWithTabs(config)}
          </div>
        </div>
      `;
    }

    function renderSubmissionConfirmation(config) {
      return `
        <div class="card-shadow rounded-lg p-8 text-center" style="background-color: ${config.surface_color};">
          <div class="splash-accent w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center">
            <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <h2 class="text-3xl font-bold mb-3" style="color: ${config.text_color};">Submission Successful!</h2>
          <p class="text-gray-600 text-lg mb-6">Your quotation has been successfully uploaded and submitted.</p>
          <div class="text-left max-w-md mx-auto bg-gray-50 p-4 rounded-lg">
            <p class="text-sm text-gray-600 mb-2"><strong>Submitted:</strong> ${new Date(currentUser.submitted_at).toLocaleString()}</p>
            <p class="text-sm text-gray-600 mb-2"><strong>Company:</strong> ${currentUser.company_name}</p>
            <p class="text-sm text-gray-600"><strong>File:</strong> ${currentUser.file_name || 'quotation.xlsx'}</p>
          </div>
          <p class="text-gray-500 mt-6">Our team will review your submission and contact you shortly.</p>
        </div>
      `;
    }

    function renderTenderContentWithTabs(config) {
      return `
        <div class="card-shadow rounded-lg" style="background-color: ${config.surface_color};">
          <div class="border-b border-gray-200">
            <div class="flex space-x-2 px-6">
              <button class="tab-button ${activeTab === 'requirements' ? 'active' : ''}" onclick="switchTab('requirements')" style="color: ${activeTab === 'requirements' ? config.secondary_color : config.text_color};">
                Tender Requirements
              </button>
              <button class="tab-button ${activeTab === 'photos' ? 'active' : ''}" onclick="switchTab('photos')" style="color: ${activeTab === 'photos' ? config.secondary_color : config.text_color};">
                Site Photos
              </button>
              <button class="tab-button ${activeTab === 'submit' ? 'active' : ''}" onclick="switchTab('submit')" style="color: ${activeTab === 'submit' ? config.secondary_color : config.text_color};">
                Submit Quotation
              </button>
            </div>
          </div>

          <div class="p-6">
            ${activeTab === 'requirements' ? renderRequirementsTab(config) : ''}
            ${activeTab === 'photos' ? renderPhotosTab(config) : ''}
            ${activeTab === 'submit' ? renderSubmitTab(config) : ''}
          </div>
        </div>
      `;
    }

    function renderRequirementsTab(config) {
      return `
        <div>
          <h2 class="text-2xl font-bold mb-4" style="color: ${config.text_color};">${config.tender_title}</h2>
          
          <div class="tender-section">
            <h3 class="text-lg font-semibold mb-2" style="color: ${config.text_color};">Prepared By</h3>
            <p class="text-gray-700">Shrunk Innovation Group Pty Ltd</p>
            <p class="text-gray-700">On behalf of: Cedar Pacific Pty Ltd</p>
            <p class="text-gray-700">Site Tenant: Unilodge</p>
            <p class="text-gray-700 mt-2"><strong>Contact:</strong> ${config.contact_name}</p>
            <p class="text-gray-700">${config.contact_details}</p>
          </div>

          <div class="tender-section">
            <h3 class="text-lg font-semibold mb-2" style="color: ${config.text_color};">Customer Overview</h3>
            <p class="text-gray-700 leading-relaxed">Cedar Pacific is one of Australia's leading specialist investors and developers in purpose-built student accommodation (PBSA) and build-to-rent (BTR) assets. They own and manage a large national portfolio of residential properties, focused on long-term asset performance, operational efficiency, and sustainability outcomes.</p>
            <p class="text-gray-700 leading-relaxed mt-3">UniLodge operates as the on-site property and facilities manager for many of Cedar Pacific's student accommodation assets. Their teams manage the day-to-day operations, including tenant engagement, cleaning, and building services.</p>
          </div>

          <div class="tender-section">
            <h3 class="text-lg font-semibold mb-2" style="color: ${config.text_color};">Services Overview</h3>
            <p class="text-gray-700 leading-relaxed">Cedar Pacific's UniLodge-operated buildings generate high volumes of General Waste, Co-mingled Recycling, and Cardboard, driven by dense student occupancy and continuous daily turnover. Most buildings operate with 7-day-per-week waste collections.</p>
            <p class="text-gray-700 leading-relaxed mt-3">Co-mingled Recycling presents consistent challenges due to the chute system. High contamination rates are common. Contractors are expected to proactively identify contamination issues and work with Shrunk and Cedar Pacific to implement practical solutions.</p>
            <p class="text-gray-700 leading-relaxed mt-3">Sites require occasional bulk dry waste, e-waste, and furniture disposal services in addition to regular collections. Clear communication, scheduling flexibility, and transparent pricing for these ad-hoc services are essential.</p>
          </div>

          <div class="tender-section">
            <h3 class="text-lg font-semibold mb-3" style="color: ${config.text_color};">Sites</h3>
            <table class="site-table">
              <thead>
                <tr>
                  <th>Site Name</th>
                  <th>State</th>
                  <th>Address</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Unilodge Melbourne CBD</td>
                  <td>VIC</td>
                  <td>17-23 Wills Street, Melbourne, VIC, 3000</td>
                </tr>
                <tr>
                  <td>Unilodge Melbourne Central</td>
                  <td>VIC</td>
                  <td>303 La Trobe Street, Melbourne, VIC, 3000</td>
                </tr>
                <tr>
                  <td>Unilodge Victoria University</td>
                  <td>VIC</td>
                  <td>101 Ballarat Road, Footscray, VIC, 3011</td>
                </tr>
                <tr>
                  <td>Unilodge Kensington</td>
                  <td>NSW</td>
                  <td>177-197 Anzac Parade, Kensington, NSW, 2033</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="tender-section">
            <h3 class="text-lg font-semibold mb-2" style="color: ${config.text_color};">Service Requirements</h3>
            <ul class="list-disc list-inside text-gray-700 space-y-2">
              <li>Early/overnight collection times preferred with provided keys/codes</li>
              <li>Drivers must move bins (~5-10m) to service location</li>
              <li>Low access rear-lift truck required for Unilodge Kensington (max height 4.3m)</li>
              <li>Trucks must have scales to weigh bins/waste with reporting capability</li>
              <li><strong>SIFOT (Service in full on time) of 99% required</strong></li>
            </ul>
          </div>

          <div class="tender-section">
            <h3 class="text-lg font-semibold mb-2" style="color: ${config.text_color};">Contamination Management</h3>
            <ul class="list-disc list-inside text-gray-700 space-y-2">
              <li>Operational cadence for discarding contaminated Co-Mingle as General Waste (same day collection)</li>
              <li>Monthly reporting on contamination events by day</li>
            </ul>
          </div>

          <div class="tender-section">
            <h3 class="text-lg font-semibold mb-2" style="color: ${config.text_color};">Reporting Requirements</h3>
            <p class="text-gray-700">Monthly reporting on number of lifts, weight, and diversion metrics via portal or Excel file</p>
          </div>

          <div class="tender-section">
            <h3 class="text-lg font-semibold mb-2" style="color: ${config.text_color};">Commencement & Term</h3>
            <p class="text-gray-700">Contract commencement: On or after 01/02/2026</p>
            <p class="text-gray-700 mt-2">Contract term: 2 years with optional 1 year extension (2+1)</p>
            <p class="text-gray-700 mt-2">Price increases: Once per annum, capped increase (with justification), on anniversary of commencement</p>
          </div>

          <div class="tender-section">
            <h3 class="text-lg font-semibold mb-2" style="color: ${config.text_color};">Quotation Requirements</h3>
            <ul class="list-disc list-inside text-gray-700 space-y-2">
              <li>General Waste pricing based on 60kg per mÂ³ density</li>
              <li>Co-Mingle pricing based on 30kg per mÂ³ density</li>
              <li>Outline all additional fees: rental, fuel levies, futile fees, energy surcharges, weekend/holiday surcharges, overweight fees</li>
              <li><strong>Providers with excessive additional fees will not be considered favorably</strong></li>
            </ul>
          </div>
        </div>
      `;
    }

    function renderPhotosTab(config) {
      return `
        <div>
          <h2 class="text-2xl font-bold mb-4" style="color: ${config.text_color};">Site Photos</h2>
          <p class="text-gray-600 mb-6">Visual documentation of waste collection areas and site access points</p>

          <div class="space-y-8">
            <div>
              <h3 class="text-xl font-semibold mb-3" style="color: ${config.text_color};">Unilodge Melbourne CBD</h3>
              <p class="text-sm text-gray-600 mb-2">17-23 Wills Street, Melbourne, VIC, 3000</p>
              <div class="photo-grid">
                ${sitePhotos.melbourne_cbd.map(photo => `
                  <div class="photo-item">
                    <img src="${photo.url}" alt="${photo.caption}" onclick="openPhotoModal('${photo.url}', '${photo.caption}')" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="photo-placeholder" style="display: none;">
                      <span>Photo: ${photo.caption}</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-2 text-center">${photo.caption}</p>
                  </div>
                `).join('')}
              </div>
            </div>

            <div>
              <h3 class="text-xl font-semibold mb-3" style="color: ${config.text_color};">Unilodge Melbourne Central</h3>
              <p class="text-sm text-gray-600 mb-2">303 La Trobe Street, Melbourne, VIC, 3000</p>
              <div class="photo-grid">
                ${sitePhotos.melbourne_central.map(photo => `
                  <div class="photo-item">
                    <img src="${photo.url}" alt="${photo.caption}" onclick="openPhotoModal('${photo.url}', '${photo.caption}')" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="photo-placeholder" style="display: none;">
                      <span>Photo: ${photo.caption}</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-2 text-center">${photo.caption}</p>
                  </div>
                `).join('')}
              </div>
            </div>

            <div>
              <h3 class="text-xl font-semibold mb-3" style="color: ${config.text_color};">Unilodge Victoria University</h3>
              <p class="text-sm text-gray-600 mb-2">101 Ballarat Road, Footscray, VIC, 3011</p>
              <div class="photo-grid">
                ${sitePhotos.victoria_university.map(photo => `
                  <div class="photo-item">
                    <img src="${photo.url}" alt="${photo.caption}" onclick="openPhotoModal('${photo.url}', '${photo.caption}')" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="photo-placeholder" style="display: none;">
                      <span>Photo: ${photo.caption}</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-2 text-center">${photo.caption}</p>
                  </div>
                `).join('')}
              </div>
            </div>

            <div>
              <h3 class="text-xl font-semibold mb-3" style="color: ${config.text_color};">Unilodge Kensington</h3>
              <p class="text-sm text-gray-600 mb-2">177-197 Anzac Parade, Kensington, NSW, 2033</p>
              <div class="photo-grid">
                ${sitePhotos.kensington.map(photo => `
                  <div class="photo-item">
                    <img src="${photo.url}" alt="${photo.caption}" onclick="openPhotoModal('${photo.url}', '${photo.caption}')" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="photo-placeholder" style="display: none;">
                      <span>Photo: ${photo.caption}</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-2 text-center">${photo.caption}</p>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>


        </div>
      `;
    }

    function renderSubmitTab(config) {
      return `
        <div>
          <h2 class="text-2xl font-bold mb-4" style="color: ${config.text_color};">Submit Your Quotation</h2>
          
          <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <h3 class="font-semibold text-blue-900 mb-2">Step 1: Download Template</h3>
            <p class="text-blue-800 mb-3">Download the Excel pricing template and complete all required fields.</p>
            <a href="https://docs.google.com/spreadsheets/d/1U2VdLfnPtXRQguYJoRP1b9eNOajtj2TWjiWgG6Gonm8/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="inline-flex items-center px-4 py-2 rounded-lg text-white font-semibold transition-all" style="background-color: ${config.primary_color};" onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
              Download Excel Template
            </a>
          </div>

          <div class="p-4 bg-green-50 rounded-lg border border-green-200">
            <h3 class="font-semibold text-green-900 mb-2">Step 2: Upload Completed Quotation</h3>
            <p class="text-green-800 mb-4">Upload your completed Excel file to submit your quotation.</p>
            
            <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
              <svg class="w-12 h-12 mx-auto mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
              <p class="text-gray-600 font-medium">Click to upload Excel file</p>
              <p class="text-gray-500 text-sm mt-1">or drag and drop</p>
              <input type="file" id="fileInput" accept=".xlsx,.xls" onchange="handleFileUpload(event)" style="display: none;">
            </div>

            <button id="uploadBtn" onclick="submitQuotation()" class="w-full mt-4 text-white font-semibold py-3 rounded-lg transition-all" style="background-color: ${config.secondary_color}; display: none;" onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'" ${isLoading ? 'disabled' : ''}>
              ${isLoading ? '<span class="loading-spinner"></span>Submitting...' : 'Submit Quotation'}
            </button>
          </div>

          <div class="mt-6 p-4 bg-purple-50 border border-purple-200 rounded-lg">
            <h3 class="font-semibold text-purple-900 mb-2">ðŸ“¡ Webhook Integration</h3>
            <p class="text-sm text-purple-800 mb-2">Submissions will be sent to your configured webhook endpoint:</p>
            <code class="text-xs bg-purple-100 px-2 py-1 rounded text-purple-900 break-all">${config.webhook_url}</code>
          </div>
        </div>
      `;
    }

    function switchTab(tab) {
      activeTab = tab;
      renderApp();
    }

    async function handleRegistration(event) {
      event.preventDefault();
      
      if (isLoading) return;

      const email = document.getElementById('email').value.trim();
      const additionalFields = document.getElementById('additionalFields');

      const existingVendor = allVendors.find(v => v.email.toLowerCase() === email.toLowerCase());
      
      if (existingVendor) {
        isLoading = true;
        renderApp();
        await new Promise(resolve => setTimeout(resolve, 500));
        currentUser = existingVendor;
        isLoading = false;
        showMessage(`Welcome back, ${existingVendor.company_name}!`, "success");
        renderApp();
        return;
      }

      if (additionalFields.style.display === 'none') {
        additionalFields.style.display = 'block';
        document.getElementById('companyName').required = true;
        document.getElementById('contactName').required = true;
        document.getElementById('phone').required = true;
        document.getElementById('submitBtn').innerHTML = 'Register & Access Tender';
        showMessage("New email - please complete registration", "success");
        return;
      }

      if (allVendors.length >= 999) {
        showMessage("Maximum vendor limit reached. Please contact support.", "error");
        return;
      }

      isLoading = true;
      renderApp();

      const companyName = document.getElementById('companyName').value.trim();
      const contactName = document.getElementById('contactName').value.trim();
      const phone = document.getElementById('phone').value.trim();

      const newVendor = {
        id: `vendor_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        email: email,
        company_name: companyName,
        contact_name: contactName,
        phone: phone,
        registered_at: new Date().toISOString(),
        submission_status: "pending",
        submitted_at: "",
        file_name: ""
      };

      const result = await window.dataSdk.create(newVendor);
      
      isLoading = false;

      if (result.isOk) {
        currentUser = newVendor;
        showMessage("Registration successful!", "success");
        renderApp();
      } else {
        showMessage("Registration failed. Please try again.", "error");
        renderApp();
      }
    }

    let selectedFile = null;

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (file) {
        selectedFile = file;
        const uploadZone = document.querySelector('.upload-zone');
        uploadZone.innerHTML = `
          <svg class="w-12 h-12 mx-auto mb-3 text-green-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
          </svg>
          <p class="text-gray-700 font-medium">${file.name}</p>
          <p class="text-gray-500 text-sm mt-1">File ready for upload</p>
        `;
        document.getElementById('uploadBtn').style.display = 'block';
      }
    }

    async function submitQuotation() {
      if (!selectedFile || isLoading) return;

      if (allVendors.length >= 999) {
        showMessage("Maximum submission limit reached. Please contact support.", "error");
        return;
      }

      isLoading = true;
      const btn = document.getElementById('uploadBtn');
      btn.disabled = true;
      btn.innerHTML = '<span class="loading-spinner"></span>Submitting...';

      const config = window.elementSdk?.config || defaultConfig;

      try {
        const webhookPayload = {
          vendor: {
            id: currentUser.id,
            email: currentUser.email,
            company_name: currentUser.company_name,
            contact_name: currentUser.contact_name,
            phone: currentUser.phone
          },
          submission: {
            file_name: selectedFile.name,
            file_size: selectedFile.size,
            file_type: selectedFile.type,
            submitted_at: new Date().toISOString()
          },
          tender: {
            title: config.tender_title,
            client: config.client_name
          }
        };

        const webhookResponse = await fetch(config.webhook_url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(webhookPayload)
        }).catch(err => {
          console.log('Webhook notification sent (or attempted):', err);
          return { ok: true };
        });

      } catch (error) {
        console.log('Webhook error (continuing with submission):', error);
      }

      await new Promise(resolve => setTimeout(resolve, 1000));

      const updatedVendor = {
        ...currentUser,
        submission_status: "submitted",
        submitted_at: new Date().toISOString(),
        file_name: selectedFile.name
      };

      const result = await window.dataSdk.update(updatedVendor);

      isLoading = false;

      if (result.isOk) {
        currentUser = updatedVendor;
        activeTab = 'requirements';
        renderApp();
        showMessage("Quotation submitted successfully!", "success");
      } else {
        showMessage("Submission failed. Please try again.", "error");
        btn.disabled = false;
        btn.innerHTML = 'Submit Quotation';
      }
    }

    function logout() {
      currentUser = null;
      selectedFile = null;
      activeTab = 'requirements';
      renderApp();
    }

    function showMessage(message, type) {
      const color = type === "error" ? "#ef4444" : "#10b981";
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: ${color};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        z-index: 1000;
        font-weight: 500;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 4000);
    }

    function openPhotoModal(url, caption) {
      const modal = document.createElement('div');
      modal.className = 'photo-modal';
      modal.innerHTML = `
        <div class="photo-modal-close" onclick="closePhotoModal(this)">Ã—</div>
        <img src="${url}" alt="${caption}">
      `;
      modal.onclick = function(e) {
        if (e.target === modal) {
          closePhotoModal(modal);
        }
      };
      document.body.appendChild(modal);
    }

    function closePhotoModal(element) {
      const modal = element.classList?.contains('photo-modal') ? element : element.closest('.photo-modal');
      if (modal) {
        modal.remove();
      }
    }

    async function onConfigChange(config) {
      renderApp();
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (value) => {
                config.secondary_color = value;
                window.elementSdk.setConfig({ secondary_color: value });
              }
            },
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (value) => {
                config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["portal_title", config.portal_title || defaultConfig.portal_title],
          ["client_name", config.client_name || defaultConfig.client_name],
          ["tender_title", config.tender_title || defaultConfig.tender_title],
          ["contact_name", config.contact_name || defaultConfig.contact_name],
          ["contact_details", config.contact_details || defaultConfig.contact_details],
          ["webhook_url", config.webhook_url || defaultConfig.webhook_url]
        ])
      });
    }

    document.addEventListener('DOMContentLoaded', initApp);
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a8097f7920e5a4f',t:'MTc2NDczOTAwNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
