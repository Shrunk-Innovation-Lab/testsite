<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tender Management Portal - Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      height: 100%;
    }
    html {
      height: 100%;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);
    }
    .splash-accent {
      background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
    }
    .card-shadow {
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    }
    .admin-edit-field {
      width: 100%;
      padding: 0.5rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.875rem;
      transition: border-color 0.2s ease;
    }
    .admin-edit-field:focus {
      outline: none;
      border-color: #8b5cf6;
    }
    .admin-section {
      background-color: #f9fafb;
      padding: 1.5rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      border: 2px dashed #d1d5db;
    }
    .admin-section:hover {
      border-color: #8b5cf6;
    }
    .admin-label {
      display: block;
      font-weight: 600;
      color: #374151;
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }
    .tab-button {
      padding: 0.75rem 1.5rem;
      border-bottom: 3px solid transparent;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
      background: none;
      border-top: none;
      border-left: none;
      border-right: none;
    }
    .tab-button:hover {
      background-color: rgba(0,0,0,0.05);
    }
    .tab-button.active {
      border-bottom-color: #8b5cf6;
      color: #8b5cf6;
    }
    .sub-tab-button {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
      background: none;
      border: 2px solid transparent;
      font-size: 0.875rem;
    }
    .sub-tab-button:hover {
      background-color: #f3f4f6;
    }
    .sub-tab-button.active {
      background-color: #ede9fe;
      border-color: #8b5cf6;
      color: #8b5cf6;
    }
    .tender-card {
      background-color: white;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .tender-card:hover {
      border-color: #8b5cf6;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .status-draft {
      background-color: #fef3c7;
      color: #92400e;
    }
    .status-active {
      background-color: #d1fae5;
      color: #065f46;
    }
    .status-closed {
      background-color: #fee2e2;
      color: #991b1b;
    }
    .delete-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background-color: #ef4444;
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.2rem;
      transition: background-color 0.2s ease;
      z-index: 10;
    }
    .delete-btn:hover {
      background-color: #dc2626;
    }
    .stat-card {
      background-color: white;
      border-radius: 12px;
      padding: 1.5rem;
      border: 2px solid #e5e7eb;
    }
    .question-item, .document-item, .service-row-item, .vendor-item {
      background-color: white;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      position: relative;
    }
    .question-item:hover, .document-item:hover, .service-row-item:hover, .vendor-item:hover {
      border-color: #8b5cf6;
    }
    .subsection-header {
      background-color: #ede9fe;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      margin-bottom: 0.75rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .photo-item {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      overflow: hidden;
      background-color: #ffffff;
      padding: 0.75rem;
      position: relative;
    }
    .photo-item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }
    .photo-placeholder {
      width: 100%;
      height: 150px;
      background-color: #e5e7eb;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }
    .add-photo-btn {
      border: 2px dashed #8b5cf6;
      background-color: #f5f3ff;
      border-radius: 12px;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .add-photo-btn:hover {
      background-color: #ede9fe;
      border-color: #7c3aed;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body>
  <div id="app" class="w-full min-h-full"></div>
  <script>
    // Admin credentials
    const ADMIN_CREDENTIALS = {
      username: "admin",
      password: "admin123"
    };

    let isAdmin = false;
    let activeTab = "dashboard";
    let activeSubTab = "basic_info";
    let activeVendorSubTab = "pending";
    let activeTenderId = null;
    let editingTender = false;
    let showVendorRegistration = false;
    
    // Global admin data structure
    let adminData = {
      globalSettings: {
        portal_name: "Tender Management Portal",
        admin_email: "admin@company.com",
        primary_color: "#7c3aed",
        secondary_color: "#8b5cf6"
      },
      tenders: [],
      vendors: [],
      submissions: []
    };

    // Template for new tender
    const getTenderTemplate = () => ({
      id: Date.now().toString(),
      name: "New Tender",
      status: "draft", // draft, active, closed
      access_type: "public", // public, invite_only, private
      created_date: new Date().toISOString(),
      close_date: "",
      contact_name: "",
      contact_details: "",
      form_endpoint: "https://formspree.io/f/YOUR_FORM_ID",
      
      customer_overview: "",
      services_overview: "",
      sites: [],
      service_requirements: {},
      site_visit: "",
      commencement_term: "",
      quotation_requirements: [],
      
      site_photos: {},
      documents: [],
      questionnaire: [],
      
      core_services: [],
      additional_services: [],
      
      approved_vendor_ids: []
    });

    function loadAdminData() {
      const stored = localStorage.getItem('admin_tender_data');
      if (stored) {
        adminData = JSON.parse(stored);
      } else {
        // Create sample tender for first time
        const sampleTender = getTenderTemplate();
        sampleTender.name = "Cedar Pacific Waste Services RFQ";
        sampleTender.status = "active";
        sampleTender.contact_name = "Nick Twining â€“ Shrunk";
        sampleTender.contact_details = "M: 0418 854 628 | E: nick@shrunk.ai";
        sampleTender.customer_overview = "Cedar Pacific is one of Australia's leading specialist investors and developers in purpose-built student accommodation (PBSA) and build-to-rent (BTR) assets. They own and manage a large national portfolio of residential properties, focused on long-term asset performance, operational efficiency, and sustainability outcomes. Cedar Pacific typically acts as the asset owner and principal contract holder for services such as waste management, maintenance, and utilities across its properties.\n\nUniLodge operates as the on-site property and facilities manager for many of Cedar Pacific's student accommodation assets. Their teams manage the day-to-day operations, including tenant engagement, cleaning, and building services, while Cedar Pacific oversees the commercial, strategic, and contractual aspects at a portfolio level.";
        sampleTender.services_overview = "Cedar Pacific's UniLodge-operated buildings generate high volumes of General Waste, Co-mingled Recycling, and Cardboard, driven by dense student occupancy and continuous daily turnover. General Waste and Co-mingled Recycling are managed through a vertical chute system, where residents dispose of materials directly via floor chutes leading to a central waste room at ground or basement level.\n\nMost Cedar Pacific / UniLodge buildings operate with 7-day-per-week waste collections, reflecting the high occupancy and continuous waste generation across the portfolio. With limited on-site storage and minimal redundancy in bin capacity, on-time, reliable collections are a critical service requirement.\n\nCo-mingled Recycling presents consistent challenges across the portfolio due to the chute system. High contamination rates are common. Contractors are expected to proactively identify contamination issues, provide feedback to UniLodge site teams, and work with Shrunk and Cedar Pacific to implement practical solutions.\n\nDue to high resident turnover and periodic clear-outs, Cedar Pacific / UniLodge sites require occasional bulk dry waste, e-waste, and furniture disposal services in addition to regular collections. Contractors must have the capability to provide this service through skip bins or alternative services, on an as-needed basis, often with short lead times. Clear communication, scheduling flexibility, and transparent pricing for these ad-hoc services are essential to support UniLodge teams during peak move-in / move-out periods and unplanned disposal events.";
        sampleTender.sites = [
          { name: "Unilodge Melbourne CBD", state: "VIC", address: "17-23 Wills Street, Melbourne, VIC, 3000" },
          { name: "Unilodge Melbourne Central", state: "VIC", address: "303 La Trobe Street, Melbourne, VIC, 3000" },
          { name: "Unilodge Victoria University", state: "VIC", address: "101 Ballarat Road, Footscray, VIC, 3011" },
          { name: "Unilodge Kensington", state: "NSW", address: "177-197 Anzac Parade, Kensington, NSW, 2033" }
        ];
        sampleTender.service_requirements = {
          "Service/Access Requirements": [
            "For all services, an early/overnight and consistent collection time is preferred between. To facilitate access, keys/code will be provided.",
            "The drivers are required to move bins in order to service (~5-10m).",
            "A low access rear-lift truck is required for Unilodge Kensington with a max height of 4.3m",
            "Trucks must have scales that can weigh the bins/waste and be reported on"
          ],
          "Service Level Guarantee": [
            "A SIFOT (Service in full on time) of 99% is required."
          ],
          "Contamination Management": [
            "An operational cadence for discarding Co-Mingle as General Waste (if too heavily contaminated) is required by the contractor (ie contaminated Co-Mingle is collected as General Waste on the same day it is presented)",
            "Reporting on the number of contamination events each month by day."
          ],
          "Reporting Requirements": [
            "Reporting on the number of lifts, weight, diversion metrics in either portal or Excel file is required on a monthly basis."
          ]
        };
        sampleTender.commencement_term = "The new waste management contract will commence on or after 01/02/2026. Cedar Pacific will consider a 2 year contract with an optional 1 year extension (2 + 1) in return for a favourable commercial proposal.\n\nFor price increases, a once per annum, capped price increase (with appropriate justification & excluding significant changes of law), occurring on the anniversary of contract commencement is preferred.";
        sampleTender.site_visit = "Site access/visit can be provided upon request.\n\nIncluded in this document are photos of the site and associated access.";
        sampleTender.quotation_requirements = [
          "For General Waste please provide pricing based off a density of 60kg per m3 and Co-Mingle off 30kg per m3",
          "Outline additional fees & charges, such as, rental fees, fuel levies, futile fees, energy surcharges, weekend & public holiday surcharges, overweight fees.",
          "Please complete the attached pricing spreadsheet with the requested information.",
          "Providers with numerous & excessive additional fees will not be considered favorably."
        ];
        sampleTender.site_photos = {
          "melbourne_cbd": [
            { url: "https://i.imgur.com/BteWMvZ.png", caption: "Building Entrance" },
            { url: "https://i.imgur.com/8uDbJhv.png", caption: "Waste Collection Area" }
          ],
          "melbourne_central": [
            { url: "https://i.imgur.com/7CJKzPR.png", caption: "Front Access" },
            { url: "https://i.imgur.com/7CJKzPR.png", caption: "Loading Dock" }
          ],
          "victoria_university": [
            { url: "https://i.imgur.com/krwtpkU.png", caption: "Site Overview" },
            { url: "https://i.imgur.com/XI9x0ct.png", caption: "Collection Point" },
            { url: "https://i.imgur.com/ISrH4Wl.png", caption: "Bin Area" }
          ],
          "kensington": [
            { url: "https://i.imgur.com/mUYtja3.png", caption: "Underground Access" },
            { url: "https://i.imgur.com/gUhXw4L.png", caption: "Waste Room" }
          ]
        };
        sampleTender.documents = [
          { title: "Cedar Pacific Sustainability Policy", url: "https://example.com/sustainability-policy.pdf" },
          { title: "Waste Management Procedures", url: "https://example.com/waste-procedures.pdf" },
          { title: "Site Access Requirements", url: "https://example.com/access-requirements.pdf" }
        ];
        sampleTender.questionnaire = [
          { id: "q1", section: "Company Information", question: "Provide a brief overview of your company including years in operation and relevant experience in student accommodation waste management.", type: "text" },
          { id: "q2", section: "Company Information", question: "Do you hold current Public Liability Insurance (minimum $20 million)?", type: "yes_no_upload" },
          { id: "q3", section: "Company Information", question: "Do you hold current Workers Compensation Insurance?", type: "yes_no_upload" },
          { id: "q4", section: "Service Delivery", question: "Describe your proposed service delivery model including vehicle fleet, collection frequency flexibility, and emergency response protocols.", type: "text" },
          { id: "q5", section: "Service Delivery", question: "Can you provide services across all listed sites?", type: "yes_no" },
          { id: "q6", section: "Sustainability", question: "Detail your waste diversion strategies and current diversion rates achieved at similar properties.", type: "text" },
          { id: "q7", section: "Sustainability", question: "Do you provide monthly reporting on waste volumes and diversion rates?", type: "yes_no" },
          { id: "q8", section: "Health & Safety", question: "Provide details of your safety management system and any relevant certifications (e.g., ISO 45001).", type: "text" },
          { id: "q9", section: "Health & Safety", question: "Do you have a documented Safe Work Method Statement (SWMS) for waste collection in multi-story buildings?", type: "yes_no_upload" }
        ];
        sampleTender.core_services = [
          { state: "VIC", site: "Unilodge Melbourne CBD", description: "General Waste", stream: "General Waste", bin: "1100L", avg: "0", frequency: "Daily", days: "Mon,Tue,Wed,Thu,Fri" },
          { state: "VIC", site: "Unilodge Melbourne CBD", description: "Co-mingled Recycling", stream: "Recycling", bin: "1100L", avg: "0", frequency: "3x per week", days: "Mon,Wed,Fri" },
          { state: "VIC", site: "Unilodge Melbourne CBD", description: "Organic Waste", stream: "Organics", bin: "240L", avg: "0", frequency: "Daily", days: "Mon,Tue,Wed,Thu,Fri" },
          { state: "VIC", site: "Unilodge RMIT", description: "General Waste", stream: "General Waste", bin: "1100L", avg: "0", frequency: "Daily", days: "Mon,Tue,Wed,Thu,Fri" },
          { state: "VIC", site: "Unilodge RMIT", description: "Co-mingled Recycling", stream: "Recycling", bin: "660L", avg: "0", frequency: "3x per week", days: "Mon,Wed,Fri" },
          { state: "VIC", site: "Unilodge on Cobden", description: "General Waste", stream: "General Waste", bin: "660L", avg: "0", frequency: "5x per week", days: "Mon,Tue,Wed,Thu,Fri" }
        ];
        sampleTender.additional_services = [
          { state: "VIC", site: "All Sites", service: "Bulk waste collection (per collection)" },
          { state: "VIC", site: "All Sites", service: "Emergency call-out (same day)" },
          { state: "VIC", site: "All Sites", service: "Bin cleaning service (per bin)" },
          { state: "VIC", site: "All Sites", service: "Additional bin supply (per bin)" }
        ];
        adminData.tenders.push(sampleTender);

        // Add sample vendors with different statuses
        adminData.vendors = [
          {
            id: "v1",
            company_name: "Veolia Environmental Services",
            staff: [
              { id: "s1", name: "Sarah Johnson", email: "sarah.johnson@veolia.com.au", phone: "0412 345 678", role: "Account Manager" },
              { id: "s2", name: "Michael Chen", email: "michael.chen@veolia.com.au", phone: "0423 456 789", role: "Operations Manager" }
            ],
            added_date: "2025-01-10T08:30:00.000Z",
            status: "approved",
            registration_type: "manual"
          },
          {
            id: "v2",
            company_name: "Cleanaway Waste Management",
            staff: [
              { id: "s3", name: "David Williams", email: "d.williams@cleanaway.com.au", phone: "0434 567 890", role: "Business Development Manager" }
            ],
            added_date: "2025-01-12T10:15:00.000Z",
            status: "approved",
            registration_type: "manual"
          },
          {
            id: "v3",
            company_name: "Suez Waste Solutions",
            staff: [
              { id: "s4", name: "Emma Thompson", email: "emma.t@suez.com.au", phone: "0445 678 901", role: "Regional Manager" }
            ],
            added_date: "2025-01-15T14:20:00.000Z",
            status: "pending",
            registration_type: "self_registered",
            notes: "Leading waste management company with 15 years experience in student accommodation. We operate across Victoria and NSW with a fleet of 50+ vehicles."
          },
          {
            id: "v4",
            company_name: "GreenCycle Recycling Co",
            staff: [
              { id: "s5", name: "James Porter", email: "james@greencycle.com.au", phone: "0456 789 012", role: "Sales Director" }
            ],
            added_date: "2025-01-16T09:45:00.000Z",
            status: "pending",
            registration_type: "self_registered",
            notes: "Specialist in recycling and organic waste management. We focus on sustainability and waste diversion with industry-leading diversion rates of 75%+."
          },
          {
            id: "v5",
            company_name: "Budget Bins & Waste",
            staff: [
              { id: "s6", name: "Tony Russo", email: "tony@budgetbins.com.au", phone: "0467 890 123", role: "Owner" }
            ],
            added_date: "2025-01-08T11:30:00.000Z",
            status: "rejected",
            registration_type: "self_registered",
            notes: "Small local operator. Services only available in outer suburbs."
          }
        ];

        // Add sample submissions
        adminData.submissions = [
          {
            id: "sub1",
            tender_id: sampleTender.id,
            company_name: "Veolia Environmental Services",
            contact_name: "Sarah Johnson",
            contact_email: "sarah.johnson@veolia.com.au",
            contact_phone: "0412 345 678",
            submitted_date: "2025-01-18T14:30:00.000Z",
            status: "received",
            questionnaire_responses: [
              { question_id: "q1", answer: "Veolia has been operating in Australia for over 25 years, providing comprehensive waste management services to commercial, industrial, and municipal clients. We currently service over 150 student accommodation properties across Australia." },
              { question_id: "q2", answer: "Yes", file_url: "https://example.com/insurance-cert.pdf" },
              { question_id: "q3", answer: "Yes", file_url: "https://example.com/workers-comp.pdf" },
              { question_id: "q4", answer: "Our fleet includes 12 modern waste collection vehicles with GPS tracking. We offer flexible collection frequencies and guarantee 4-hour emergency response times. Our 24/7 operations center manages all service requests." },
              { question_id: "q5", answer: "Yes" },
              { question_id: "q6", answer: "We achieve an average 68% waste diversion rate across our student accommodation portfolio. Our strategies include dedicated recycling streams, organic waste processing, and comprehensive resident education programs." },
              { question_id: "q7", answer: "Yes" },
              { question_id: "q8", answer: "Veolia operates under ISO 45001 certified safety management system. All staff complete comprehensive safety training including work at heights, manual handling, and site-specific inductions." },
              { question_id: "q9", answer: "Yes", file_url: "https://example.com/swms-multistory.pdf" }
            ],
            core_services_pricing: [
              { service_index: 0, monthly_price: "2,850", annual_price: "34,200" },
              { service_index: 1, monthly_price: "1,420", annual_price: "17,040" },
              { service_index: 2, monthly_price: "890", annual_price: "10,680" },
              { service_index: 3, monthly_price: "2,850", annual_price: "34,200" },
              { service_index: 4, monthly_price: "1,180", annual_price: "14,160" },
              { service_index: 5, monthly_price: "1,650", annual_price: "19,800" }
            ],
            additional_services_pricing: [
              { service_index: 0, price: "450" },
              { service_index: 1, price: "380" },
              { service_index: 2, price: "95" },
              { service_index: 3, price: "280" }
            ],
            total_annual_cost: "130,080"
          },
          {
            id: "sub2",
            tender_id: sampleTender.id,
            company_name: "Cleanaway Waste Management",
            contact_name: "David Williams",
            contact_email: "d.williams@cleanaway.com.au",
            contact_phone: "0434 567 890",
            submitted_date: "2025-01-20T09:15:00.000Z",
            status: "received",
            questionnaire_responses: [
              { question_id: "q1", answer: "Cleanaway is Australia's leading waste management company with 50+ years of experience. We service over 200 education facilities nationally including major university student accommodations." },
              { question_id: "q2", answer: "Yes", file_url: "https://example.com/cleanaway-insurance.pdf" },
              { question_id: "q3", answer: "Yes", file_url: "https://example.com/cleanaway-workers-comp.pdf" },
              { question_id: "q4", answer: "Our dedicated education sector team operates 8 vehicles in Melbourne metro. Collections available 7 days/week with 2-hour emergency response guarantee. Real-time service tracking via customer portal." },
              { question_id: "q5", answer: "Yes" },
              { question_id: "q6", answer: "Current diversion rate of 72% across education portfolio. We provide quarterly sustainability reports, contamination audits, and resident engagement workshops to maximize recycling participation." },
              { question_id: "q7", answer: "Yes" },
              { question_id: "q8", answer: "Cleanaway maintains ISO 45001 certification. All staff hold required licenses and complete annual refresher training. Comprehensive SWMS library covering all service scenarios." },
              { question_id: "q9", answer: "Yes", file_url: "https://example.com/cleanaway-swms.pdf" }
            ],
            core_services_pricing: [
              { service_index: 0, monthly_price: "2,650", annual_price: "31,800" },
              { service_index: 1, monthly_price: "1,350", annual_price: "16,200" },
              { service_index: 2, monthly_price: "820", annual_price: "9,840" },
              { service_index: 3, monthly_price: "2,650", annual_price: "31,800" },
              { service_index: 4, monthly_price: "1,120", annual_price: "13,440" },
              { service_index: 5, monthly_price: "1,580", annual_price: "18,960" }
            ],
            additional_services_pricing: [
              { service_index: 0, price: "420" },
              { service_index: 1, price: "350" },
              { service_index: 2, price: "85" },
              { service_index: 3, price: "250" }
            ],
            total_annual_cost: "122,040"
          }
        ];
      }
    }

    function saveAdminData() {
      localStorage.setItem('admin_tender_data', JSON.stringify(adminData));
    }

    function initApp() {
      loadAdminData();
      renderApp();
    }

    function renderApp() {
      const app = document.getElementById('app');
      
      if (!isAdmin) {
        app.innerHTML = renderAdminLogin();
      } else {
        app.innerHTML = renderAdminPanel();
      }
    }

    function renderAdminLogin() {
      if (showVendorRegistration) {
        return renderVendorRegistrationForm();
      }

      return `
        <div class="w-full min-h-full flex items-center justify-center" style="background-color: #f9fafb;">
          <div class="card-shadow rounded-lg p-8 w-full max-w-md" style="background-color: white;">
            <div class="text-center mb-6">
              <div class="splash-accent w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-gray-900">Admin Login</h2>
              <p class="text-gray-600 mt-2">Enter credentials to access admin panel</p>
            </div>

            <form onsubmit="handleAdminLogin(event)">
              <div class="mb-4">
                <label for="username" class="admin-label">Username</label>
                <input type="text" id="username" required class="admin-edit-field">
              </div>

              <div class="mb-6">
                <label for="password" class="admin-label">Password</label>
                <input type="password" id="password" required class="admin-edit-field">
              </div>

              <button type="submit" class="w-full text-white font-semibold py-3 rounded-lg transition-all mb-4" style="background-color: #8b5cf6;" onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
                Login
              </button>
            </form>

            <div class="text-center pt-4 border-t border-gray-200">
              <p class="text-sm text-gray-600 mb-3">Are you a vendor?</p>
              <button onclick="showVendorRegistration = true; renderApp();" class="text-purple-600 hover:text-purple-700 font-semibold text-sm flex items-center justify-center mx-auto">
                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                </svg>
                Register Your Company
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderVendorRegistrationForm() {
      return `
        <div class="w-full min-h-full flex items-center justify-center p-6" style="background-color: #f9fafb;">
          <div class="card-shadow rounded-lg p-8 w-full max-w-2xl" style="background-color: white;">
            <div class="text-center mb-6">
              <div class="splash-accent w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-gray-900">Vendor Registration</h2>
              <p class="text-gray-600 mt-2">Register your company to participate in tenders</p>
            </div>

            <form onsubmit="handleVendorRegistration(event)">
              <div class="admin-section">
                <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Company Information</h3>
                
                <div class="mb-4">
                  <label for="company_name" class="admin-label">Company Name *</label>
                  <input type="text" id="company_name" name="company_name" required class="admin-edit-field" placeholder="e.g., Veolia Environmental Services">
                </div>
              </div>

              <div class="admin-section">
                <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Primary Contact Person</h3>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                  <div>
                    <label for="contact_name" class="admin-label">Full Name *</label>
                    <input type="text" id="contact_name" name="contact_name" required class="admin-edit-field" placeholder="John Smith">
                  </div>
                  <div>
                    <label for="contact_role" class="admin-label">Role/Position</label>
                    <input type="text" id="contact_role" name="contact_role" class="admin-edit-field" placeholder="Business Development Manager">
                  </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4">
                  <div>
                    <label for="contact_email" class="admin-label">Email Address *</label>
                    <input type="email" id="contact_email" name="contact_email" required class="admin-edit-field" placeholder="john.smith@company.com">
                  </div>
                  <div>
                    <label for="contact_phone" class="admin-label">Phone Number</label>
                    <input type="tel" id="contact_phone" name="contact_phone" class="admin-edit-field" placeholder="+61 400 000 000">
                  </div>
                </div>
              </div>

              <div class="admin-section">
                <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Additional Information</h3>
                <label for="notes" class="admin-label">Brief Company Description (Optional)</label>
                <textarea id="notes" name="notes" rows="3" class="admin-edit-field" placeholder="Tell us about your company, services offered, and relevant experience..."></textarea>
              </div>

              <div class="flex gap-3">
                <button type="button" onclick="showVendorRegistration = false; renderApp();" class="flex-1 px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-semibold">
                  Cancel
                </button>
                <button type="submit" class="flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold">
                  Submit Registration
                </button>
              </div>

              <p class="text-xs text-gray-500 text-center mt-4">* Required fields. Your registration will be reviewed by an administrator.</p>
            </form>
          </div>
        </div>
      `;
    }

    function renderAdminPanel() {
      return `
        <div class="w-full min-h-full" style="background-color: #f9fafb;">
          <div class="gradient-bg w-full py-6">
            <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
              <div>
                <h1 class="text-3xl font-bold text-white">${adminData.globalSettings.portal_name}</h1>
                <p class="text-white text-opacity-90 mt-1">Administrative Dashboard</p>
              </div>
              <button onclick="logout()" class="text-white bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
                Logout
              </button>
            </div>
          </div>

          <div class="max-w-7xl mx-auto px-6 py-8">
            <div class="card-shadow rounded-lg" style="background-color: white;">
              <div class="border-b border-gray-200">
                <div class="flex space-x-2 px-6 overflow-x-auto">
                  <button class="tab-button ${activeTab === 'dashboard' ? 'active' : ''}" onclick="switchTab('dashboard')" style="color: ${activeTab === 'dashboard' ? adminData.globalSettings.secondary_color : '#374151'};">
                    <svg class="w-5 h-5 inline-block mr-2 -mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    Dashboard
                  </button>
                  <button class="tab-button ${activeTab === 'tenders' ? 'active' : ''}" onclick="switchTab('tenders')" style="color: ${activeTab === 'tenders' ? adminData.globalSettings.secondary_color : '#374151'};">
                    <svg class="w-5 h-5 inline-block mr-2 -mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Tenders
                  </button>
                  <button class="tab-button ${activeTab === 'vendors' ? 'active' : ''}" onclick="switchTab('vendors')" style="color: ${activeTab === 'vendors' ? adminData.globalSettings.secondary_color : '#374151'};">
                    <svg class="w-5 h-5 inline-block mr-2 -mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    Approved Vendors
                  </button>
                  <button class="tab-button ${activeTab === 'submissions' ? 'active' : ''}" onclick="switchTab('submissions')" style="color: ${activeTab === 'submissions' ? adminData.globalSettings.secondary_color : '#374151'};">
                    <svg class="w-5 h-5 inline-block mr-2 -mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                    </svg>
                    Submissions
                  </button>
                </div>
              </div>

              <div class="p-6">
                ${activeTab === 'dashboard' ? renderDashboard() : ''}
                ${activeTab === 'tenders' ? renderTendersTab() : ''}
                ${activeTab === 'vendors' ? renderVendorsTab() : ''}
                ${activeTab === 'submissions' ? renderSubmissionsTab() : ''}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderDashboard() {
      const totalTenders = adminData.tenders.length;
      const activeTenders = adminData.tenders.filter(t => t.status === 'active').length;
      const totalVendors = adminData.vendors.length;
      const totalSubmissions = adminData.submissions.length;

      return `
        <div>
          <h2 class="text-2xl font-bold mb-6" style="color: #374151;">Dashboard Overview</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="stat-card">
              <div class="text-3xl font-bold" style="color: #8b5cf6;">${totalTenders}</div>
              <div class="text-sm text-gray-600 mt-1">Total Tenders</div>
            </div>
            <div class="stat-card">
              <div class="text-3xl font-bold" style="color: #10b981;">${activeTenders}</div>
              <div class="text-sm text-gray-600 mt-1">Active Tenders</div>
            </div>
            <div class="stat-card">
              <div class="text-3xl font-bold" style="color: #f59e0b;">${totalVendors}</div>
              <div class="text-sm text-gray-600 mt-1">Approved Vendors</div>
            </div>
            <div class="stat-card">
              <div class="text-3xl font-bold" style="color: #3b82f6;">${totalSubmissions}</div>
              <div class="text-sm text-gray-600 mt-1">Total Submissions</div>
            </div>
          </div>

          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Recent Tenders</h3>
            ${adminData.tenders.slice(0, 5).map(tender => `
              <div class="tender-card" onclick="editTender('${tender.id}')">
                <div class="flex justify-between items-start mb-2">
                  <h4 class="font-semibold text-lg">${tender.name}</h4>
                  <span class="status-badge status-${tender.status}">${tender.status.toUpperCase()}</span>
                </div>
                <p class="text-sm text-gray-600">Created: ${new Date(tender.created_date).toLocaleDateString()}</p>
                <p class="text-sm text-gray-600">Access: ${tender.access_type}</p>
              </div>
            `).join('')}
            ${adminData.tenders.length === 0 ? '<p class="text-gray-500 text-center py-8">No tenders created yet. Go to Tenders tab to create one!</p>' : ''}
          </div>

          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Recent Submissions</h3>
            ${adminData.submissions.slice(0, 5).map(submission => {
              const tender = adminData.tenders.find(t => t.id === submission.tender_id);
              return `
                <div class="question-item">
                  <div class="flex justify-between items-start">
                    <div>
                      <h4 class="font-semibold">${submission.company_name || 'Unknown Company'}</h4>
                      <p class="text-sm text-gray-600">Tender: ${tender ? tender.name : 'Unknown'}</p>
                      <p class="text-sm text-gray-600">Submitted: ${new Date(submission.submitted_date).toLocaleDateString()}</p>
                    </div>
                    <button onclick="viewSubmission('${submission.id}')" class="px-3 py-1 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-sm">View</button>
                  </div>
                </div>
              `;
            }).join('')}
            ${adminData.submissions.length === 0 ? '<p class="text-gray-500 text-center py-8">No submissions yet.</p>' : ''}
          </div>
        </div>
      `;
    }

    function renderTendersTab() {
      if (editingTender && activeTenderId) {
        return renderTenderEditor();
      }

      return `
        <div>
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold" style="color: #374151;">Tender Management</h2>
            <button onclick="createNewTender()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Create New Tender
            </button>
          </div>

          <div class="grid grid-cols-1 gap-4">
            ${adminData.tenders.map(tender => `
              <div class="tender-card">
                <div class="flex justify-between items-start">
                  <div class="flex-1">
                    <div class="flex items-center gap-3 mb-2">
                      <h3 class="text-xl font-bold">${tender.name}</h3>
                      <span class="status-badge status-${tender.status}">${tender.status.toUpperCase()}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-sm text-gray-600 mb-3">
                      <p class="flex items-center">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        Created: ${new Date(tender.created_date).toLocaleDateString()}
                      </p>
                      <p class="flex items-center">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        Access: ${tender.access_type.replace('_', ' ').toUpperCase()}
                      </p>
                      <p class="flex items-center">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        Sites: ${tender.sites.length}
                      </p>
                      <p class="flex items-center">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Questions: ${tender.questionnaire.length}
                      </p>
                    </div>
                    <p class="text-sm text-gray-700">${tender.customer_overview.substring(0, 150)}${tender.customer_overview.length > 150 ? '...' : ''}</p>
                  </div>
                  <div class="flex gap-2 ml-4">
                    <button onclick="editTender('${tender.id}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                      Edit
                    </button>
                    <button onclick="duplicateTender('${tender.id}')" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                      Duplicate
                    </button>
                    <button onclick="deleteTender('${tender.id}')" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            `).join('')}
            ${adminData.tenders.length === 0 ? '<p class="text-gray-500 text-center py-12">No tenders yet. Create your first tender to get started!</p>' : ''}
          </div>
        </div>
      `;
    }

    function renderTenderEditor() {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (!tender) return '<p>Tender not found</p>';

      return `
        <div>
          <div class="flex justify-between items-center mb-6">
            <div>
              <button onclick="backToTenderList()" class="text-purple-600 hover:text-purple-700 font-semibold mb-2 flex items-center">
                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Back to Tenders
              </button>
              <h2 class="text-2xl font-bold" style="color: #374151;">Editing: ${tender.name}</h2>
            </div>
            <button onclick="saveCurrentTender()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              Save Changes
            </button>
          </div>

          <div class="bg-gray-100 p-4 rounded-lg mb-6 flex gap-2 overflow-x-auto">
            <button class="sub-tab-button ${activeSubTab === 'basic_info' ? 'active' : ''}" onclick="switchSubTab('basic_info')">
              Basic Info
            </button>
            <button class="sub-tab-button ${activeSubTab === 'requirements' ? 'active' : ''}" onclick="switchSubTab('requirements')">
              Tender Requirements
            </button>
            <button class="sub-tab-button ${activeSubTab === 'photos' ? 'active' : ''}" onclick="switchSubTab('photos')">
              Site Photos
            </button>
            <button class="sub-tab-button ${activeSubTab === 'questionnaire' ? 'active' : ''}" onclick="switchSubTab('questionnaire')">
              Questionnaire
            </button>
            <button class="sub-tab-button ${activeSubTab === 'quotation' ? 'active' : ''}" onclick="switchSubTab('quotation')">
              Quotation Table
            </button>
          </div>

          <div>
            ${activeSubTab === 'basic_info' ? renderBasicInfo(tender) : ''}
            ${activeSubTab === 'requirements' ? renderRequirements(tender) : ''}
            ${activeSubTab === 'photos' ? renderPhotos(tender) : ''}
            ${activeSubTab === 'questionnaire' ? renderQuestionnaire(tender) : ''}
            ${activeSubTab === 'quotation' ? renderQuotation(tender) : ''}
          </div>
        </div>
      `;
    }

    function renderBasicInfo(tender) {
      return `
        <div>
          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Basic Information</h3>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label class="admin-label">Tender Name</label>
                <input type="text" value="${tender.name}" onchange="updateTenderField('name', this.value)" class="admin-edit-field">
              </div>
              <div>
                <label class="admin-label">Status</label>
                <select onchange="updateTenderField('status', this.value)" class="admin-edit-field">
                  <option value="draft" ${tender.status === 'draft' ? 'selected' : ''}>Draft</option>
                  <option value="active" ${tender.status === 'active' ? 'selected' : ''}>Active</option>
                  <option value="closed" ${tender.status === 'closed' ? 'selected' : ''}>Closed</option>
                </select>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label class="admin-label">Access Type</label>
                <select onchange="updateTenderField('access_type', this.value)" class="admin-edit-field">
                  <option value="public" ${tender.access_type === 'public' ? 'selected' : ''}>Public (Anyone with link)</option>
                  <option value="invite_only" ${tender.access_type === 'invite_only' ? 'selected' : ''}>Invite Only (Approved vendors)</option>
                  <option value="private" ${tender.access_type === 'private' ? 'selected' : ''}>Private (Specific emails)</option>
                </select>
              </div>
              <div>
                <label class="admin-label">Close Date (Optional)</label>
                <input type="date" value="${tender.close_date}" onchange="updateTenderField('close_date', this.value)" class="admin-edit-field">
              </div>
            </div>

            <div class="mb-4">
              <label class="admin-label">Contact Name</label>
              <input type="text" value="${tender.contact_name}" onchange="updateTenderField('contact_name', this.value)" class="admin-edit-field">
            </div>

            <div class="mb-4">
              <label class="admin-label">Contact Details</label>
              <input type="text" value="${tender.contact_details}" onchange="updateTenderField('contact_details', this.value)" class="admin-edit-field">
            </div>

            <div class="mb-4">
              <label class="admin-label">Form Submission Endpoint</label>
              <input type="text" value="${tender.form_endpoint}" onchange="updateTenderField('form_endpoint', this.value)" class="admin-edit-field">
            </div>
          </div>

          ${tender.access_type !== 'public' ? `
            <div class="admin-section">
              <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Approved Vendors for This Tender</h3>
              <p class="text-sm text-gray-600 mb-4">Select which vendors can access this tender</p>
              
              ${adminData.vendors.map(vendor => `
                <label class="flex items-center mb-2 p-3 bg-white rounded-lg border-2 border-gray-200 hover:border-purple-300 cursor-pointer">
                  <input type="checkbox" ${tender.approved_vendor_ids.includes(vendor.id) ? 'checked' : ''} 
                         onchange="toggleVendorAccess('${vendor.id}', this.checked)" 
                         class="mr-3 w-5 h-5">
                  <div>
                    <div class="font-semibold">${vendor.company_name}</div>
                    <div class="text-sm text-gray-600">${vendor.email}</div>
                  </div>
                </label>
              `).join('')}
              
              ${adminData.vendors.length === 0 ? '<p class="text-gray-500 text-center py-4">No vendors added yet. Go to Approved Vendors tab to add vendors.</p>' : ''}
            </div>
          ` : ''}
        </div>
      `;
    }

    function renderRequirements(tender) {
      return `
        <div>
          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Customer Overview</h3>
            <textarea rows="8" onchange="updateTenderField('customer_overview', this.value)" class="admin-edit-field">${tender.customer_overview}</textarea>
          </div>

          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Services Overview</h3>
            <textarea rows="12" onchange="updateTenderField('services_overview', this.value)" class="admin-edit-field">${tender.services_overview}</textarea>
          </div>

          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Sites</h3>
            <div id="sitesList">
              ${tender.sites.map((site, index) => `
                <div class="question-item mb-3">
                  <div class="delete-btn" onclick="deleteTenderSite(${index})" title="Delete site">Ã—</div>
                  <div class="grid grid-cols-3 gap-3">
                    <div>
                      <label class="admin-label">Site Name</label>
                      <input type="text" value="${site.name}" onchange="updateTenderSite(${index}, 'name', this.value)" class="admin-edit-field">
                    </div>
                    <div>
                      <label class="admin-label">State</label>
                      <input type="text" value="${site.state}" onchange="updateTenderSite(${index}, 'state', this.value)" class="admin-edit-field">
                    </div>
                    <div>
                      <label class="admin-label">Address</label>
                      <input type="text" value="${site.address}" onchange="updateTenderSite(${index}, 'address', this.value)" class="admin-edit-field">
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
            <button onclick="addTenderSite()" class="mt-3 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">+ Add Site</button>
          </div>

          <div class="admin-section">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-semibold" style="color: #374151;">Service Requirements</h3>
              <button onclick="addServiceRequirementSubsection()" class="px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700">+ Add New Subsection</button>
            </div>
            
            ${Object.keys(tender.service_requirements).map(subsection => `
              <div class="mb-4 bg-white rounded-lg border-2 border-gray-200 overflow-hidden">
                <div class="subsection-header" style="background-color: #ede9fe; padding: 0.75rem 1rem; margin-bottom: 0;">
                  <input type="text" value="${subsection}" onchange="renameServiceRequirementSubsection('${subsection}', this.value)" class="text-base font-semibold bg-transparent border-b-2 border-purple-400 focus:border-purple-600 outline-none px-2 py-1" style="color: #6b21a8;">
                  <button onclick="deleteServiceRequirementSubsection('${subsection}')" class="px-3 py-1 bg-red-500 text-white text-sm rounded-lg hover:bg-red-600">Delete Subsection</button>
                </div>
                
                <div class="p-4">
                  ${tender.service_requirements[subsection].map((req, index) => `
                    <div class="flex items-start mb-2 gap-2">
                      <span class="text-purple-600 font-semibold mt-2">â€¢</span>
                      <input type="text" value="${req}" onchange="updateServiceRequirement('${subsection}', ${index}, this.value)" class="admin-edit-field flex-1">
                      <button onclick="deleteServiceRequirement('${subsection}', ${index})" class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 flex-shrink-0">Ã—</button>
                    </div>
                  `).join('')}
                  <button onclick="addServiceRequirement('${subsection}')" class="mt-3 px-4 py-2 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700">+ Add Item</button>
                </div>
              </div>
            `).join('')}
          </div>

          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Commencement & Term</h3>
            <textarea rows="5" onchange="updateTenderField('commencement_term', this.value)" class="admin-edit-field">${tender.commencement_term}</textarea>
          </div>

          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Quotation Requirements</h3>
            <div>
              ${tender.quotation_requirements.map((req, index) => `
                <div class="flex items-center mb-2">
                  <input type="text" value="${req}" onchange="updateQuotationRequirement(${index}, this.value)" class="admin-edit-field mr-2">
                  <button onclick="deleteQuotationRequirement(${index})" class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">Ã—</button>
                </div>
              `).join('')}
            </div>
            <button onclick="addQuotationRequirement()" class="mt-3 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">+ Add Requirement</button>
          </div>

          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Site Visit</h3>
            <textarea rows="3" onchange="updateTenderField('site_visit', this.value)" class="admin-edit-field">${tender.site_visit}</textarea>
          </div>
        </div>
      `;
    }

    function renderPhotos(tender) {
      const siteKeys = Object.keys(tender.site_photos);
      
      return `
        <div>
          <h2 class="text-2xl font-bold mb-6" style="color: #374151;">Site Photos Management</h2>

          ${siteKeys.map(siteKey => {
            const siteName = siteKey.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            return `
              <div class="admin-section">
                <h3 class="text-lg font-semibold mb-4" style="color: #374151;">${siteName}</h3>
                <div class="photo-grid">
                  ${tender.site_photos[siteKey].map((photo, index) => `
                    <div class="photo-item">
                      <div class="delete-btn" onclick="deletePhoto('${siteKey}', ${index})" title="Delete photo">Ã—</div>
                      ${photo.url ? `<img src="${photo.url}" alt="${photo.caption}" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">` : `<div class="photo-placeholder">No Image</div>`}
                      <div class="mt-2">
                        <label class="admin-label text-xs">Image URL</label>
                        <input type="text" value="${photo.url}" onchange="updatePhoto('${siteKey}', ${index}, 'url', this.value)" class="admin-edit-field text-xs mb-2" placeholder="https://...">
                        <label class="admin-label text-xs">Caption</label>
                        <input type="text" value="${photo.caption}" onchange="updatePhoto('${siteKey}', ${index}, 'caption', this.value)" class="admin-edit-field text-xs">
                      </div>
                    </div>
                  `).join('')}
                  <div class="add-photo-btn" onclick="addPhoto('${siteKey}')">
                    <svg class="w-12 h-12 text-purple-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <span class="text-sm font-medium text-purple-600">Add Photo</span>
                  </div>
                </div>
              </div>
            `;
          }).join('')}

          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Add New Site Photo Category</h3>
            <div class="flex items-center">
              <input type="text" id="newSiteKey" placeholder="e.g., sydney_campus" class="admin-edit-field mr-2" style="max-width: 300px;">
              <button onclick="addNewSiteCategory()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Add Category</button>
            </div>
          </div>
        </div>
      `;
    }

    function renderQuestionnaire(tender) {
      return `
        <div>
          <h2 class="text-2xl font-bold mb-6" style="color: #374151;">Supplier Questionnaire</h2>
          
          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Policy Documents</h3>
            <div>
              ${tender.documents.map((doc, index) => `
                <div class="document-item">
                  <div class="delete-btn" onclick="deleteDocument(${index})" title="Delete document">Ã—</div>
                  <div class="grid grid-cols-2 gap-3">
                    <div>
                      <label class="admin-label">Document Title</label>
                      <input type="text" value="${doc.title}" onchange="updateDocument(${index}, 'title', this.value)" class="admin-edit-field">
                    </div>
                    <div>
                      <label class="admin-label">Document URL</label>
                      <input type="text" value="${doc.url}" onchange="updateDocument(${index}, 'url', this.value)" class="admin-edit-field">
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
            <button onclick="addDocument()" class="mt-3 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">+ Add Document</button>
          </div>

          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Questionnaire Questions</h3>
            <div>
              ${tender.questionnaire.map((q, index) => `
                <div class="question-item">
                  <div class="delete-btn" onclick="deleteQuestion(${index})" title="Delete question">Ã—</div>
                  <div class="mb-3">
                    <label class="admin-label">Section</label>
                    <input type="text" value="${q.section}" onchange="updateQuestion(${index}, 'section', this.value)" class="admin-edit-field">
                  </div>
                  <div class="mb-3">
                    <label class="admin-label">Question</label>
                    <textarea rows="2" onchange="updateQuestion(${index}, 'question', this.value)" class="admin-edit-field">${q.question}</textarea>
                  </div>
                  <div>
                    <label class="admin-label">Answer Type</label>
                    <select onchange="updateQuestion(${index}, 'type', this.value)" class="admin-edit-field">
                      <option value="text" ${q.type === 'text' ? 'selected' : ''}>Text Area</option>
                      <option value="yes_no" ${q.type === 'yes_no' ? 'selected' : ''}>Yes/No</option>
                      <option value="yes_no_upload" ${q.type === 'yes_no_upload' ? 'selected' : ''}>Yes/No with Upload</option>
                    </select>
                  </div>
                </div>
              `).join('')}
            </div>
            <button onclick="addQuestion()" class="mt-3 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">+ Add Question</button>
          </div>
        </div>
      `;
    }

    function renderQuotation(tender) {
      // Initialize pricing assumptions if not present
      if (!tender.pricing_assumptions) {
        tender.pricing_assumptions = {
          annual_uplift_percent: "2.5",
          general_waste_density: "60",
          comingle_density: "30"
        };
      }

      return `
        <div>
          <h2 class="text-2xl font-bold mb-6" style="color: #374151;">Quotation Table</h2>
          
          <div class="admin-section">
            <h3 class="text-lg font-semibold mb-4" style="color: #374151;">Pricing Assumptions</h3>
            <p class="text-sm text-gray-600 mb-4">Set default assumptions that vendors can adjust if needed when submitting their quotation.</p>
            
            <div class="grid grid-cols-3 gap-4">
              <div>
                <label class="admin-label">Annual (capped) Uplift %</label>
                <div class="flex items-center">
                  <input type="number" step="0.1" value="${tender.pricing_assumptions.annual_uplift_percent}" 
                         onchange="updatePricingAssumption('annual_uplift_percent', this.value)" 
                         class="admin-edit-field" style="max-width: 120px;">
                  <span class="ml-2 text-gray-600 font-semibold">%</span>
                </div>
              </div>
              <div>
                <label class="admin-label">General Waste Density</label>
                <div class="flex items-center">
                  <input type="number" step="1" value="${tender.pricing_assumptions.general_waste_density}" 
                         onchange="updatePricingAssumption('general_waste_density', this.value)" 
                         class="admin-edit-field" style="max-width: 120px;">
                  <span class="ml-2 text-gray-600 font-semibold">kg/mÂ³</span>
                </div>
              </div>
              <div>
                <label class="admin-label">Co-mingled Recycling Density</label>
                <div class="flex items-center">
                  <input type="number" step="1" value="${tender.pricing_assumptions.comingle_density}" 
                         onchange="updatePricingAssumption('comingle_density', this.value)" 
                         class="admin-edit-field" style="max-width: 120px;">
                  <span class="ml-2 text-gray-600 font-semibold">kg/mÂ³</span>
                </div>
              </div>
            </div>
          </div>

          <div class="admin-section">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-semibold" style="color: #374151;">Core Services</h3>
              <button onclick="clearAllCoreServices()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm font-semibold flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Clear All
              </button>
            </div>
            
            <div class="mb-4 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
              <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-blue-600 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <div class="flex-1">
                  <h4 class="font-semibold text-blue-900 mb-2">Import from CSV/Excel</h4>
                  <p class="text-sm text-blue-800 mb-3">Upload a CSV or Excel file to bulk import core services. Required columns: <strong>State, Site Name, Description, Stream, Bin Size, Avg Collection, Frequency, Days</strong></p>
                  <div class="flex gap-2">
                    <input type="file" id="coreServicesFile" accept=".csv,.xlsx,.xls" class="text-sm" onchange="handleCoreServicesUpload(event)">
                    <button onclick="clearCoreServicesFile()" class="px-3 py-1 bg-gray-500 text-white text-sm rounded-lg hover:bg-gray-600">Clear</button>
                  </div>
                </div>
              </div>
            </div>

            <div>
              ${tender.core_services.map((service, index) => `
                <div class="service-row-item">
                  <div class="delete-btn" onclick="deleteCoreService(${index})" title="Delete service">Ã—</div>
                  <div class="grid grid-cols-4 gap-2 mb-2">
                    <div>
                      <label class="admin-label text-xs">State</label>
                      <input type="text" value="${service.state}" onchange="updateCoreService(${index}, 'state', this.value)" class="admin-edit-field text-sm">
                    </div>
                    <div>
                      <label class="admin-label text-xs">Site</label>
                      <input type="text" value="${service.site}" onchange="updateCoreService(${index}, 'site', this.value)" class="admin-edit-field text-sm">
                    </div>
                    <div>
                      <label class="admin-label text-xs">Description</label>
                      <input type="text" value="${service.description}" onchange="updateCoreService(${index}, 'description', this.value)" class="admin-edit-field text-sm">
                    </div>
                    <div>
                      <label class="admin-label text-xs">Stream</label>
                      <input type="text" value="${service.stream}" onchange="updateCoreService(${index}, 'stream', this.value)" class="admin-edit-field text-sm">
                    </div>
                  </div>
                  <div class="grid grid-cols-4 gap-2">
                    <div>
                      <label class="admin-label text-xs">Bin Size</label>
                      <input type="text" value="${service.bin}" onchange="updateCoreService(${index}, 'bin', this.value)" class="admin-edit-field text-sm">
                    </div>
                    <div>
                      <label class="admin-label text-xs">
                        Avg Collection
                        <span class="info-tooltip" title="Per collection/per visit">
                          <svg class="w-3.5 h-3.5 inline-block ml-1 text-purple-600 cursor-help" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
                          </svg>
                        </span>
                      </label>
                      <input type="text" value="${service.avg}" onchange="updateCoreService(${index}, 'avg', this.value)" class="admin-edit-field text-sm">
                    </div>
                    <div>
                      <label class="admin-label text-xs">Frequency</label>
                      <input type="text" value="${service.frequency}" onchange="updateCoreService(${index}, 'frequency', this.value)" class="admin-edit-field text-sm">
                    </div>
                    <div>
                      <label class="admin-label text-xs">Days</label>
                      <input type="text" value="${service.days}" onchange="updateCoreService(${index}, 'days', this.value)" class="admin-edit-field text-sm">
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
            <button onclick="addCoreService()" class="mt-3 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">+ Add Core Service</button>
          </div>

          <div class="admin-section">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-semibold" style="color: #374151;">Additional Services</h3>
              <button onclick="clearAllAdditionalServices()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 text-sm font-semibold flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Clear All
              </button>
            </div>
            
            <div class="mb-4 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
              <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-blue-600 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <div class="flex-1">
                  <h4 class="font-semibold text-blue-900 mb-2">Import from CSV/Excel</h4>
                  <p class="text-sm text-blue-800 mb-3">Upload a CSV or Excel file to bulk import additional services. Required columns: State, Site, Service</p>
                  <div class="flex gap-2">
                    <input type="file" id="additionalServicesFile" accept=".csv,.xlsx,.xls" class="text-sm" onchange="handleAdditionalServicesUpload(event)">
                    <button onclick="clearAdditionalServicesFile()" class="px-3 py-1 bg-gray-500 text-white text-sm rounded-lg hover:bg-gray-600">Clear</button>
                  </div>
                </div>
              </div>
            </div>

            <div>
              ${tender.additional_services.map((service, index) => `
                <div class="service-row-item">
                  <div class="delete-btn" onclick="deleteAdditionalService(${index})" title="Delete service">Ã—</div>
                  <div class="grid grid-cols-3 gap-3">
                    <div>
                      <label class="admin-label text-xs">State</label>
                      <input type="text" value="${service.state}" onchange="updateAdditionalService(${index}, 'state', this.value)" class="admin-edit-field">
                    </div>
                    <div>
                      <label class="admin-label text-xs">Site</label>
                      <input type="text" value="${service.site}" onchange="updateAdditionalService(${index}, 'site', this.value)" class="admin-edit-field">
                    </div>
                    <div>
                      <label class="admin-label text-xs">Service</label>
                      <input type="text" value="${service.service}" onchange="updateAdditionalService(${index}, 'service', this.value)" class="admin-edit-field">
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
            <button onclick="addAdditionalService()" class="mt-3 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">+ Add Additional Service</button>
          </div>
        </div>
      `;
    }

    function renderVendorsTab() {
      const pendingVendors = adminData.vendors.filter(v => v.status === 'pending');
      const approvedVendors = adminData.vendors.filter(v => v.status === 'approved');
      const rejectedVendors = adminData.vendors.filter(v => v.status === 'rejected');

      // Default to pending if there are any, otherwise approved
      if (!activeVendorSubTab) {
        activeVendorSubTab = pendingVendors.length > 0 ? 'pending' : 'approved';
      }

      return `
        <div>
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold" style="color: #374151;">Vendor Management</h2>
            <button onclick="addVendor()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Add Vendor
            </button>
          </div>

          <p class="text-sm text-gray-600 mb-6 bg-blue-50 p-3 rounded-lg border border-blue-200">
            <strong>Note:</strong> Vendors can self-register (appears as "Pending") or you can add them manually. Vendors are companies (e.g., Veolia). Add staff members under each vendor - they'll be able to access tenders assigned to their company.
          </p>

          <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="stat-card cursor-pointer transition-all ${activeVendorSubTab === 'pending' ? 'ring-2 ring-purple-600' : ''}" onclick="switchVendorSubTab('pending')" style="border: 2px solid ${activeVendorSubTab === 'pending' ? '#8b5cf6' : '#e5e7eb'};">
              <div class="flex items-center justify-between mb-2">
                <div class="text-3xl font-bold" style="color: #f59e0b;">${pendingVendors.length}</div>
                <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div class="text-sm text-gray-600 font-medium">Pending Approval</div>
            </div>
            <div class="stat-card cursor-pointer transition-all ${activeVendorSubTab === 'approved' ? 'ring-2 ring-purple-600' : ''}" onclick="switchVendorSubTab('approved')" style="border: 2px solid ${activeVendorSubTab === 'approved' ? '#8b5cf6' : '#e5e7eb'};">
              <div class="flex items-center justify-between mb-2">
                <div class="text-3xl font-bold" style="color: #10b981;">${approvedVendors.length}</div>
                <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div class="text-sm text-gray-600 font-medium">Approved</div>
            </div>
            <div class="stat-card cursor-pointer transition-all ${activeVendorSubTab === 'rejected' ? 'ring-2 ring-purple-600' : ''}" onclick="switchVendorSubTab('rejected')" style="border: 2px solid ${activeVendorSubTab === 'rejected' ? '#8b5cf6' : '#e5e7eb'};">
              <div class="flex items-center justify-between mb-2">
                <div class="text-3xl font-bold" style="color: #ef4444;">${rejectedVendors.length}</div>
                <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div class="text-sm text-gray-600 font-medium">Rejected</div>
            </div>
          </div>

          <div>
            ${activeVendorSubTab === 'pending' ? `
              <div>
                ${pendingVendors.length > 0 ? `
                  <div class="grid grid-cols-1 gap-4">
                    ${pendingVendors.map(vendor => renderVendorCard(vendor, true)).join('')}
                  </div>
                ` : `
                  <div class="text-center py-12">
                    <p class="text-gray-500">No pending vendor approvals</p>
                  </div>
                `}
              </div>
            ` : ''}
            
            ${activeVendorSubTab === 'approved' ? `
              <div>
                ${approvedVendors.length > 0 ? `
                  <div class="grid grid-cols-1 gap-4">
                    ${approvedVendors.map(vendor => renderVendorCard(vendor, false)).join('')}
                  </div>
                ` : `
                  <div class="text-center py-12">
                    <p class="text-gray-500">No approved vendors yet</p>
                  </div>
                `}
              </div>
            ` : ''}
            
            ${activeVendorSubTab === 'rejected' ? `
              <div>
                ${rejectedVendors.length > 0 ? `
                  <div class="grid grid-cols-1 gap-4">
                    ${rejectedVendors.map(vendor => renderVendorCard(vendor, false)).join('')}
                  </div>
                ` : `
                  <div class="text-center py-12">
                    <p class="text-gray-500">No rejected vendors</p>
                  </div>
                `}
              </div>
            ` : ''}
          </div>
        </div>
      `;
    }

    function renderVendorCard(vendor, showApprovalButtons) {
      const statusColors = {
        pending: 'bg-yellow-100 text-yellow-800',
        approved: 'bg-green-100 text-green-800',
        rejected: 'bg-red-100 text-red-800'
      };

      return `
        <div class="bg-white p-4 rounded-lg border-2 ${vendor.status === 'pending' ? 'border-yellow-300' : 'border-gray-200'}">
          ${showApprovalButtons ? `
            <div class="flex gap-2 mb-4">
              <button onclick="approveVendor('${vendor.id}')" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold flex items-center justify-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                Approve
              </button>
              <button onclick="rejectVendor('${vendor.id}')" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold flex items-center justify-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
                Reject
              </button>
            </div>
          ` : ''}
          
          <div class="flex justify-between items-start mb-4">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-2">
                <label class="admin-label mb-0">Company Name</label>
                <span class="status-badge ${statusColors[vendor.status]} text-xs">${vendor.status.toUpperCase()}</span>
                ${vendor.registration_type === 'self_registered' ? '<span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Self-Registered</span>' : ''}
              </div>
              <input type="text" value="${vendor.company_name}" onchange="updateVendorField('${vendor.id}', 'company_name', this.value); saveAdminData();" class="admin-edit-field" style="max-width: 400px;">
              <p class="text-xs text-gray-500 mt-1">Added: ${new Date(vendor.added_date).toLocaleDateString()}</p>
              ${vendor.notes ? `<p class="text-xs text-gray-600 mt-2 bg-gray-50 p-2 rounded"><strong>Notes:</strong> ${vendor.notes}</p>` : ''}
            </div>
            <button onclick="deleteVendor('${vendor.id}')" class="px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm">
              Delete
            </button>
          </div>

          <div class="bg-gray-50 p-4 rounded-lg border-2 border-gray-200">
            <div class="flex justify-between items-center mb-3">
              <h4 class="font-semibold text-gray-700">Staff Members (${vendor.staff.length})</h4>
              <button onclick="addStaffMember('${vendor.id}')" class="px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700">
                + Add Staff
              </button>
            </div>

            ${vendor.staff.length === 0 ? `
              <p class="text-sm text-gray-500 text-center py-4">No staff members yet. Add staff who can respond to tenders.</p>
            ` : `
              <div class="space-y-2">
                ${vendor.staff.map(staff => `
                  <div class="bg-white p-3 rounded-lg border border-gray-200 relative">
                    <div class="delete-btn" onclick="deleteStaffMember('${vendor.id}', '${staff.id}')" title="Delete staff">Ã—</div>
                    <div class="grid grid-cols-4 gap-3">
                      <div>
                        <label class="admin-label text-xs">Name</label>
                        <input type="text" value="${staff.name}" onchange="updateStaffMember('${vendor.id}', '${staff.id}', 'name', this.value); saveAdminData();" class="admin-edit-field text-sm">
                      </div>
                      <div>
                        <label class="admin-label text-xs">Email</label>
                        <input type="email" value="${staff.email}" onchange="updateStaffMember('${vendor.id}', '${staff.id}', 'email', this.value); saveAdminData();" class="admin-edit-field text-sm">
                      </div>
                      <div>
                        <label class="admin-label text-xs">Phone</label>
                        <input type="text" value="${staff.phone}" onchange="updateStaffMember('${vendor.id}', '${staff.id}', 'phone', this.value); saveAdminData();" class="admin-edit-field text-sm">
                      </div>
                      <div>
                        <label class="admin-label text-xs">Role</label>
                        <input type="text" value="${staff.role}" onchange="updateStaffMember('${vendor.id}', '${staff.id}', 'role', this.value); saveAdminData();" class="admin-edit-field text-sm">
                      </div>
                    </div>
                  </div>
                `).join('')}
              </div>
            `}
          </div>
        </div>
      `;
    }

    function renderSubmissionsTab() {
      return `
        <div>
          <h2 class="text-2xl font-bold mb-6" style="color: #374151;">Tender Submissions</h2>

          ${adminData.submissions.length === 0 ? `
            <p class="text-gray-500 text-center py-12">No submissions yet.</p>
          ` : `
            <div class="grid grid-cols-1 gap-3">
              ${adminData.submissions.map(submission => {
                const tender = adminData.tenders.find(t => t.id === submission.tender_id);
                return `
                  <div class="question-item">
                    <div class="flex justify-between items-start">
                      <div class="flex-1">
                        <h3 class="text-lg font-bold">${submission.company_name || 'Unknown Company'}</h3>
                        <p class="text-sm text-gray-600">Tender: ${tender ? tender.name : 'Unknown'}</p>
                        <p class="text-sm text-gray-600">Contact: ${submission.contact_email || 'N/A'}</p>
                        <p class="text-sm text-gray-600">Submitted: ${new Date(submission.submitted_date).toLocaleDateString()}</p>
                        ${submission.status ? `<span class="status-badge status-${submission.status} mt-2">${submission.status.toUpperCase()}</span>` : ''}
                      </div>
                      <div class="flex gap-2">
                        <button onclick="viewSubmission('${submission.id}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                          View Details
                        </button>
                        <button onclick="exportSubmission('${submission.id}')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                          Export
                        </button>
                      </div>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          `}
        </div>
      `;
    }

    // Event handlers
    function handleAdminLogin(event) {
      event.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
        isAdmin = true;
        showMessage("Login successful!", "success");
        renderApp();
      } else {
        showMessage("Invalid credentials", "error");
      }
    }

    function logout() {
      isAdmin = false;
      activeTab = "dashboard";
      activeTenderId = null;
      editingTender = false;
      renderApp();
    }

    function switchTab(tab) {
      activeTab = tab;
      if (tab !== 'tenders') {
        editingTender = false;
        activeTenderId = null;
      }
      renderApp();
    }

    function switchSubTab(subTab) {
      activeSubTab = subTab;
      renderApp();
    }

    function switchVendorSubTab(subTab) {
      activeVendorSubTab = subTab;
      renderApp();
    }

    function createNewTender() {
      const newTender = getTenderTemplate();
      adminData.tenders.push(newTender);
      activeTenderId = newTender.id;
      editingTender = true;
      activeSubTab = 'basic_info';
      renderApp();
    }

    function editTender(tenderId) {
      activeTenderId = tenderId;
      editingTender = true;
      activeSubTab = 'basic_info';
      activeTab = 'tenders';
      renderApp();
    }

    function backToTenderList() {
      editingTender = false;
      activeTenderId = null;
      renderApp();
    }

    function duplicateTender(tenderId) {
      const tender = adminData.tenders.find(t => t.id === tenderId);
      if (tender) {
        const duplicate = JSON.parse(JSON.stringify(tender));
        duplicate.id = Date.now().toString();
        duplicate.name = tender.name + " (Copy)";
        duplicate.status = "draft";
        duplicate.created_date = new Date().toISOString();
        adminData.tenders.push(duplicate);
        saveAdminData();
        showMessage("Tender duplicated successfully!", "success");
        renderApp();
      }
    }

    function deleteTender(tenderId) {
      if (confirm('Are you sure you want to delete this tender? This action cannot be undone.')) {
        adminData.tenders = adminData.tenders.filter(t => t.id !== tenderId);
        saveAdminData();
        showMessage("Tender deleted successfully!", "success");
        renderApp();
      }
    }

    function saveCurrentTender() {
      saveAdminData();
      showMessage("Tender saved successfully!", "success");
    }

    function updateTenderField(field, value) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender[field] = value;
      }
    }

    function toggleVendorAccess(vendorId, checked) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        if (checked) {
          if (!tender.approved_vendor_ids.includes(vendorId)) {
            tender.approved_vendor_ids.push(vendorId);
          }
        } else {
          tender.approved_vendor_ids = tender.approved_vendor_ids.filter(id => id !== vendorId);
        }
      }
    }

    // Tender-specific update functions
    function updateTenderSite(index, field, value) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) tender.sites[index][field] = value;
    }

    function addTenderSite() {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.sites.push({ name: "New Site", state: "VIC", address: "" });
        renderApp();
      }
    }

    function deleteTenderSite(index) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.sites.splice(index, 1);
        renderApp();
      }
    }

    function updateServiceRequirement(subsection, index, value) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) tender.service_requirements[subsection][index] = value;
    }

    function addServiceRequirement(subsection) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.service_requirements[subsection].push("New requirement");
        renderApp();
      }
    }

    function deleteServiceRequirement(subsection, index) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.service_requirements[subsection].splice(index, 1);
        renderApp();
      }
    }

    function addServiceRequirementSubsection() {
      const name = prompt("Enter subsection name:");
      if (name && name.trim()) {
        const tender = adminData.tenders.find(t => t.id === activeTenderId);
        if (tender) {
          tender.service_requirements[name.trim()] = ["New item"];
          renderApp();
        }
      }
    }

    function deleteServiceRequirementSubsection(subsection) {
      if (confirm(`Delete "${subsection}" subsection?`)) {
        const tender = adminData.tenders.find(t => t.id === activeTenderId);
        if (tender) {
          delete tender.service_requirements[subsection];
          renderApp();
        }
      }
    }

    function renameServiceRequirementSubsection(oldName, newName) {
      if (newName && newName.trim() && newName !== oldName) {
        const tender = adminData.tenders.find(t => t.id === activeTenderId);
        if (tender) {
          const items = tender.service_requirements[oldName];
          delete tender.service_requirements[oldName];
          tender.service_requirements[newName] = items;
          renderApp();
        }
      }
    }

    function updateQuotationRequirement(index, value) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) tender.quotation_requirements[index] = value;
    }

    function addQuotationRequirement() {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.quotation_requirements.push("New requirement");
        renderApp();
      }
    }

    function deleteQuotationRequirement(index) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.quotation_requirements.splice(index, 1);
        renderApp();
      }
    }

    function updatePhoto(siteKey, index, field, value) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.site_photos[siteKey][index][field] = value;
        renderApp();
      }
    }

    function addPhoto(siteKey) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.site_photos[siteKey].push({ url: "", caption: "New Photo" });
        renderApp();
      }
    }

    function deletePhoto(siteKey, index) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.site_photos[siteKey].splice(index, 1);
        renderApp();
      }
    }

    function addNewSiteCategory() {
      const key = document.getElementById('newSiteKey').value.trim().toLowerCase().replace(/\s+/g, '_');
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (key && tender && !tender.site_photos[key]) {
        tender.site_photos[key] = [];
        renderApp();
      }
    }

    function updateDocument(index, field, value) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) tender.documents[index][field] = value;
    }

    function addDocument() {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.documents.push({ title: "New Document", url: "" });
        renderApp();
      }
    }

    function deleteDocument(index) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.documents.splice(index, 1);
        renderApp();
      }
    }

    function updateQuestion(index, field, value) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) tender.questionnaire[index][field] = value;
    }

    function addQuestion() {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.questionnaire.push({
          id: `q${tender.questionnaire.length + 1}`,
          section: "New Section",
          question: "New question?",
          type: "text"
        });
        renderApp();
      }
    }

    function deleteQuestion(index) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.questionnaire.splice(index, 1);
        renderApp();
      }
    }

    function updateCoreService(index, field, value) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) tender.core_services[index][field] = value;
    }

    function addCoreService() {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.core_services.push({
          state: "VIC", site: "New Site", description: "Service", stream: "General Waste",
          bin: "1100L", avg: "0", frequency: "Daily", days: "Mon,Tue,Wed,Thu,Fri"
        });
        renderApp();
      }
    }

    function deleteCoreService(index) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.core_services.splice(index, 1);
        renderApp();
      }
    }

    function clearAllCoreServices() {
      showConfirmDialog(
        'Clear All Core Services?',
        'Are you sure you want to clear all core services? This action cannot be undone.',
        () => {
          const tender = adminData.tenders.find(t => t.id === activeTenderId);
          if (tender) {
            tender.core_services = [];
            saveAdminData();
            showMessage("All core services cleared!", "success");
            renderApp();
          }
        }
      );
    }

    function clearAllAdditionalServices() {
      showConfirmDialog(
        'Clear All Additional Services?',
        'Are you sure you want to clear all additional services? This action cannot be undone.',
        () => {
          const tender = adminData.tenders.find(t => t.id === activeTenderId);
          if (tender) {
            tender.additional_services = [];
            saveAdminData();
            showMessage("All additional services cleared!", "success");
            renderApp();
          }
        }
      );
    }

    function showConfirmDialog(title, message, onConfirm) {
      const overlay = document.createElement('div');
      overlay.style.cssText = `
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background-color: rgba(0, 0, 0, 0.5); z-index: 10000;
        display: flex; align-items: center; justify-content: center;
      `;
      
      const dialog = document.createElement('div');
      dialog.style.cssText = `
        background-color: white; border-radius: 12px; padding: 2rem;
        max-width: 400px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
      `;
      
      dialog.innerHTML = `
        <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; color: #374151;">${title}</h3>
        <p style="color: #6b7280; margin-bottom: 1.5rem;">${message}</p>
        <div style="display: flex; gap: 0.75rem;">
          <button id="cancelBtn" style="flex: 1; padding: 0.75rem; background-color: #e5e7eb; color: #374151; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
            Cancel
          </button>
          <button id="confirmBtn" style="flex: 1; padding: 0.75rem; background-color: #ef4444; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
            Confirm
          </button>
        </div>
      `;
      
      overlay.appendChild(dialog);
      document.body.appendChild(overlay);
      
      document.getElementById('cancelBtn').onclick = () => {
        overlay.remove();
      };
      
      document.getElementById('confirmBtn').onclick = () => {
        overlay.remove();
        onConfirm();
      };
      
      overlay.onclick = (e) => {
        if (e.target === overlay) overlay.remove();
      };
    }

    function updateAdditionalService(index, field, value) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) tender.additional_services[index][field] = value;
    }

    function addAdditionalService() {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.additional_services.push({ state: "VIC", site: "New Site", service: "Service Description" });
        renderApp();
      }
    }

    function deleteAdditionalService(index) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        tender.additional_services.splice(index, 1);
        renderApp();
      }
    }

    function updatePricingAssumption(field, value) {
      const tender = adminData.tenders.find(t => t.id === activeTenderId);
      if (tender) {
        if (!tender.pricing_assumptions) {
          tender.pricing_assumptions = {
            annual_uplift_percent: "2.5",
            general_waste_density: "60",
            comingle_density: "30"
          };
        }
        tender.pricing_assumptions[field] = value;
      }
    }

    // CSV/Excel Import Functions
    function parseCSV(text) {
      const lines = text.split('\n').filter(line => line.trim());
      if (lines.length === 0) return [];
      
      const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
      const rows = [];
      
      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',').map(v => v.trim().replace(/^"|"$/g, ''));
        const row = {};
        headers.forEach((header, index) => {
          row[header] = values[index] || '';
        });
        rows.push(row);
      }
      
      return rows;
    }

    function parseExcelFile(arrayBuffer) {
      try {
        // Use SheetJS library to parse Excel file
        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
        
        // Get the first sheet
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        
        // Convert to JSON with header row
        const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
          header: 1,
          defval: '',
          blankrows: false
        });
        
        console.log("Excel parsed successfully");
        console.log("Total rows found:", jsonData.length);
        console.log("First 3 rows:", jsonData.slice(0, 3));
        
        if (jsonData.length === 0) return [];
        
        // Convert to objects with headers
        const headers = jsonData[0];
        const data = [];
        
        for (let i = 1; i < jsonData.length; i++) {
          if (!jsonData[i] || jsonData[i].length === 0) continue; // Skip empty rows
          
          const row = {};
          headers.forEach((header, index) => {
            row[header] = jsonData[i][index] !== undefined ? String(jsonData[i][index]) : '';
          });
          data.push(row);
        }
        
        console.log("Final parsed data:", data.length, "rows");
        console.log("Sample row:", data[0]);
        return data;
        
      } catch (error) {
        console.error("Excel parsing error:", error);
        return [];
      }
    }

    function handleCoreServicesUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const isExcel = file.name.endsWith('.xlsx') || file.name.endsWith('.xls');
      
      if (isExcel) {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const rows = parseExcelFile(e.target.result);
            
            const tender = adminData.tenders.find(t => t.id === activeTenderId);
            if (!tender) return;
            
            console.log("Excel Headers found:", rows.length > 0 ? Object.keys(rows[0]) : "No rows");
            console.log("First row data:", rows[0]);
            
            // Map columns to core service fields
            const services = rows.map(row => ({
              state: row['State'] || '',
              site: row['Site Name'] || '',
              description: row['Description'] || '',
              stream: row['Stream'] || '',
              bin: row['Bin Size'] || '',
              avg: row['Avg Collection'] || '0',
              frequency: row['Frequency'] || '',
              days: row['Days'] || ''
            })).filter(s => s.state || s.site);
            
            console.log("Parsed services:", services);
            
            if (services.length > 0) {
              tender.core_services = services;
              showMessage(`Successfully imported ${services.length} core services!`, "success");
              renderApp();
            } else {
              const foundHeaders = rows.length > 0 ? Object.keys(rows[0]).join(', ') : 'No headers found';
              showMessage(`No valid data found. Found headers: ${foundHeaders}. Expected: State, Site Name, Description, Stream, Bin Size, Avg Collection, Frequency, Days`, "error");
            }
          } catch (error) {
            showMessage("Error parsing Excel file: " + error.message, "error");
            console.error(error);
          }
        };
        reader.readAsArrayBuffer(file);
      } else {
        // CSV file
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const text = e.target.result;
            const rows = parseCSV(text);
            
            const tender = adminData.tenders.find(t => t.id === activeTenderId);
            if (!tender) return;
            
            const services = rows.map(row => ({
              state: row['State'] || '',
              site: row['Site Name'] || '',
              description: row['Description'] || '',
              stream: row['Stream'] || '',
              bin: row['Bin Size'] || '',
              avg: row['Avg Collection'] || '0',
              frequency: row['Frequency'] || '',
              days: row['Days'] || ''
            })).filter(s => s.state || s.site);
            
            if (services.length > 0) {
              tender.core_services = services;
              showMessage(`Successfully imported ${services.length} core services!`, "success");
              renderApp();
            } else {
              const foundHeaders = rows.length > 0 ? Object.keys(rows[0]).join(', ') : 'No headers found';
              showMessage(`No valid data found. Found headers: ${foundHeaders}. Expected: State, Site Name, Description, Stream, Bin Size, Avg Collection, Frequency, Days`, "error");
            }
          } catch (error) {
            showMessage("Error parsing CSV file.", "error");
            console.error(error);
          }
        };
        reader.readAsText(file);
      }
    }

    function handleAdditionalServicesUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const isExcel = file.name.endsWith('.xlsx') || file.name.endsWith('.xls');
      
      if (isExcel) {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const rows = parseExcelFile(e.target.result);
            
            const tender = adminData.tenders.find(t => t.id === activeTenderId);
            if (!tender) return;
            
            const services = rows.map(row => ({
              state: row['State'] || row['state'] || '',
              site: row['Site'] || row['site'] || '',
              service: row['Service'] || row['service'] || ''
            })).filter(s => s.state || s.site || s.service);
            
            if (services.length > 0) {
              tender.additional_services = services;
              showMessage(`Successfully imported ${services.length} additional services!`, "success");
              renderApp();
            } else {
              showMessage("No valid data found in file. Check column names match: State, Site, Service", "error");
            }
          } catch (error) {
            showMessage("Error parsing Excel file: " + error.message, "error");
            console.error(error);
          }
        };
        reader.readAsArrayBuffer(file);
      } else {
        // CSV file
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const text = e.target.result;
            const rows = parseCSV(text);
            
            const tender = adminData.tenders.find(t => t.id === activeTenderId);
            if (!tender) return;
            
            const services = rows.map(row => ({
              state: row['State'] || row['state'] || '',
              site: row['Site'] || row['site'] || '',
              service: row['Service'] || row['service'] || ''
            })).filter(s => s.state || s.site || s.service);
            
            if (services.length > 0) {
              tender.additional_services = services;
              showMessage(`Successfully imported ${services.length} additional services!`, "success");
              renderApp();
            } else {
              showMessage("No valid data found in file. Check column names match: State, Site, Service", "error");
            }
          } catch (error) {
            showMessage("Error parsing CSV file.", "error");
            console.error(error);
          }
        };
        reader.readAsText(file);
      }
    }

    function clearCoreServicesFile() {
      const fileInput = document.getElementById('coreServicesFile');
      if (fileInput) fileInput.value = '';
    }

    function clearAdditionalServicesFile() {
      const fileInput = document.getElementById('additionalServicesFile');
      if (fileInput) fileInput.value = '';
    }

    // Vendor management
    function addVendor() {
      adminData.vendors.push({
        id: Date.now().toString(),
        company_name: "New Vendor Company",
        staff: [],
        added_date: new Date().toISOString(),
        status: "approved", // approved, pending, rejected
        registration_type: "manual" // manual or self_registered
      });
      saveAdminData();
      showMessage("Vendor added successfully!", "success");
      renderApp();
    }

    function approveVendor(vendorId) {
      const vendor = adminData.vendors.find(v => v.id === vendorId);
      if (vendor) {
        vendor.status = "approved";
        saveAdminData();
        showMessage("Vendor approved!", "success");
        renderApp();
      }
    }

    function rejectVendor(vendorId) {
      const vendor = adminData.vendors.find(v => v.id === vendorId);
      if (vendor) {
        vendor.status = "rejected";
        saveAdminData();
        showMessage("Vendor rejected!", "success");
        renderApp();
      }
    }

    function handleVendorRegistration(event) {
      event.preventDefault();
      const formData = new FormData(event.target);
      
      const newVendor = {
        id: Date.now().toString(),
        company_name: formData.get('company_name'),
        staff: [{
          id: Date.now().toString(),
          name: formData.get('contact_name'),
          email: formData.get('contact_email'),
          phone: formData.get('contact_phone'),
          role: formData.get('contact_role') || "Primary Contact"
        }],
        added_date: new Date().toISOString(),
        status: "pending",
        registration_type: "self_registered",
        notes: formData.get('notes') || ""
      };

      adminData.vendors.push(newVendor);
      saveAdminData();
      
      showMessage("Registration submitted! Awaiting admin approval.", "success");
      showVendorRegistration = false;
      renderApp();
    }

    function editVendor(vendorId) {
      // This is now handled inline in the UI
      saveAdminData();
      renderApp();
    }

    function deleteVendor(vendorId) {
      adminData.vendors = adminData.vendors.filter(v => v.id !== vendorId);
      // Remove vendor from all tenders
      adminData.tenders.forEach(tender => {
        tender.approved_vendor_ids = tender.approved_vendor_ids.filter(id => id !== vendorId);
      });
      saveAdminData();
      showMessage("Vendor deleted!", "success");
      renderApp();
    }

    function updateVendorField(vendorId, field, value) {
      const vendor = adminData.vendors.find(v => v.id === vendorId);
      if (vendor) {
        vendor[field] = value;
      }
    }

    function addStaffMember(vendorId) {
      const vendor = adminData.vendors.find(v => v.id === vendorId);
      if (vendor) {
        vendor.staff.push({
          id: Date.now().toString(),
          name: "New Staff Member",
          email: "staff@company.com",
          phone: "",
          role: "Contact"
        });
        renderApp();
      }
    }

    function updateStaffMember(vendorId, staffId, field, value) {
      const vendor = adminData.vendors.find(v => v.id === vendorId);
      if (vendor) {
        const staff = vendor.staff.find(s => s.id === staffId);
        if (staff) staff[field] = value;
      }
    }

    function deleteStaffMember(vendorId, staffId) {
      const vendor = adminData.vendors.find(v => v.id === vendorId);
      if (vendor) {
        vendor.staff = vendor.staff.filter(s => s.id !== staffId);
        renderApp();
      }
    }

    // Submission handlers
    function viewSubmission(submissionId) {
      const submission = adminData.submissions.find(s => s.id === submissionId);
      if (!submission) {
        showMessage("Submission not found!", "error");
        return;
      }

      const tender = adminData.tenders.find(t => t.id === submission.tender_id);
      
      const overlay = document.createElement('div');
      overlay.style.cssText = `
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background-color: rgba(0, 0, 0, 0.5); z-index: 10000;
        display: flex; align-items: center; justify-content: center;
        padding: 2rem; overflow-y: auto;
      `;
      
      const modal = document.createElement('div');
      modal.style.cssText = `
        background-color: white; border-radius: 12px; padding: 2rem;
        max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
      `;
      
      let questionnaireHTML = '';
      if (submission.questionnaire_responses && submission.questionnaire_responses.length > 0) {
        let currentSection = '';
        submission.questionnaire_responses.forEach(response => {
          const question = tender.questionnaire.find(q => q.id === response.question_id);
          if (question) {
            if (question.section !== currentSection) {
              if (currentSection !== '') questionnaireHTML += '</div>';
              currentSection = question.section;
              questionnaireHTML += `
                <div style="margin-bottom: 1.5rem;">
                  <h4 style="font-size: 1rem; font-weight: 600; color: #8b5cf6; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #ede9fe;">
                    ${currentSection}
                  </h4>
              `;
            }
            questionnaireHTML += `
              <div style="margin-bottom: 1.5rem; padding: 1rem; background-color: #f9fafb; border-radius: 8px;">
                <p style="font-weight: 600; color: #374151; margin-bottom: 0.5rem;">${question.question}</p>
                <p style="color: #6b7280;">${response.answer || 'No answer provided'}</p>
                ${response.file_url ? `<p style="margin-top: 0.5rem;"><a href="${response.file_url}" target="_blank" rel="noopener noreferrer" style="color: #8b5cf6; text-decoration: underline;">ðŸ“Ž View Uploaded Document</a></p>` : ''}
              </div>
            `;
          }
        });
        if (currentSection !== '') questionnaireHTML += '</div>';
      }

      let coreServicesHTML = '';
      if (submission.core_services_pricing && submission.core_services_pricing.length > 0) {
        coreServicesHTML = `
          <table style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
            <thead>
              <tr style="background-color: #f3f4f6;">
                <th style="padding: 0.75rem; text-align: left; border: 1px solid #e5e7eb;">Service</th>
                <th style="padding: 0.75rem; text-align: left; border: 1px solid #e5e7eb;">Site</th>
                <th style="padding: 0.75rem; text-align: right; border: 1px solid #e5e7eb;">Monthly</th>
                <th style="padding: 0.75rem; text-align: right; border: 1px solid #e5e7eb;">Annual</th>
              </tr>
            </thead>
            <tbody>
              ${submission.core_services_pricing.map(pricing => {
                const service = tender.core_services[pricing.service_index];
                return `
                  <tr>
                    <td style="padding: 0.75rem; border: 1px solid #e5e7eb;">${service ? service.description : 'N/A'}</td>
                    <td style="padding: 0.75rem; border: 1px solid #e5e7eb;">${service ? service.site : 'N/A'}</td>
                    <td style="padding: 0.75rem; text-align: right; border: 1px solid #e5e7eb;">$${pricing.monthly_price}</td>
                    <td style="padding: 0.75rem; text-align: right; border: 1px solid #e5e7eb;">$${pricing.annual_price}</td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        `;
      }

      let additionalServicesHTML = '';
      if (submission.additional_services_pricing && submission.additional_services_pricing.length > 0) {
        additionalServicesHTML = `
          <table style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
            <thead>
              <tr style="background-color: #f3f4f6;">
                <th style="padding: 0.75rem; text-align: left; border: 1px solid #e5e7eb;">Service</th>
                <th style="padding: 0.75rem; text-align: left; border: 1px solid #e5e7eb;">Site</th>
                <th style="padding: 0.75rem; text-align: right; border: 1px solid #e5e7eb;">Price</th>
              </tr>
            </thead>
            <tbody>
              ${submission.additional_services_pricing.map(pricing => {
                const service = tender.additional_services[pricing.service_index];
                return `
                  <tr>
                    <td style="padding: 0.75rem; border: 1px solid #e5e7eb;">${service ? service.service : 'N/A'}</td>
                    <td style="padding: 0.75rem; border: 1px solid #e5e7eb;">${service ? service.site : 'N/A'}</td>
                    <td style="padding: 0.75rem; text-align: right; border: 1px solid #e5e7eb;">$${pricing.price}</td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        `;
      }
      
      modal.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem;">
          <div>
            <h2 style="font-size: 1.5rem; font-weight: 700; color: #374151; margin-bottom: 0.5rem;">
              Submission Details
            </h2>
            <p style="color: #6b7280; font-size: 0.875rem;">
              Tender: ${tender ? tender.name : 'Unknown'}
            </p>
          </div>
          <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 1.5rem; color: #9ca3af; cursor: pointer; padding: 0.25rem;">
            Ã—
          </button>
        </div>

        <div style="background-color: #f3f4f6; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
          <h3 style="font-size: 1.125rem; font-weight: 600; color: #374151; margin-bottom: 1rem;">Company Information</h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
            <div>
              <p style="font-size: 0.75rem; font-weight: 600; color: #6b7280; margin-bottom: 0.25rem;">COMPANY NAME</p>
              <p style="color: #374151; font-weight: 500;">${submission.company_name || 'N/A'}</p>
            </div>
            <div>
              <p style="font-size: 0.75rem; font-weight: 600; color: #6b7280; margin-bottom: 0.25rem;">CONTACT NAME</p>
              <p style="color: #374151; font-weight: 500;">${submission.contact_name || 'N/A'}</p>
            </div>
            <div>
              <p style="font-size: 0.75rem; font-weight: 600; color: #6b7280; margin-bottom: 0.25rem;">EMAIL</p>
              <p style="color: #374151; font-weight: 500;">${submission.contact_email || 'N/A'}</p>
            </div>
            <div>
              <p style="font-size: 0.75rem; font-weight: 600; color: #6b7280; margin-bottom: 0.25rem;">PHONE</p>
              <p style="color: #374151; font-weight: 500;">${submission.contact_phone || 'N/A'}</p>
            </div>
            <div>
              <p style="font-size: 0.75rem; font-weight: 600; color: #6b7280; margin-bottom: 0.25rem;">SUBMITTED DATE</p>
              <p style="color: #374151; font-weight: 500;">${new Date(submission.submitted_date).toLocaleDateString()} at ${new Date(submission.submitted_date).toLocaleTimeString()}</p>
            </div>
            <div>
              <p style="font-size: 0.75rem; font-weight: 600; color: #6b7280; margin-bottom: 0.25rem;">TOTAL ANNUAL COST</p>
              <p style="color: #10b981; font-weight: 700; font-size: 1.25rem;">$${submission.total_annual_cost || 'N/A'}</p>
            </div>
          </div>
        </div>

        ${questionnaireHTML ? `
          <div style="margin-bottom: 1.5rem;">
            <h3 style="font-size: 1.125rem; font-weight: 600; color: #374151; margin-bottom: 1rem;">Questionnaire Responses</h3>
            ${questionnaireHTML}
          </div>
        ` : ''}

        ${coreServicesHTML ? `
          <div style="margin-bottom: 1.5rem;">
            <h3 style="font-size: 1.125rem; font-weight: 600; color: #374151; margin-bottom: 1rem;">Core Services Pricing</h3>
            ${coreServicesHTML}
          </div>
        ` : ''}

        ${additionalServicesHTML ? `
          <div style="margin-bottom: 1.5rem;">
            <h3 style="font-size: 1.125rem; font-weight: 600; color: #374151; margin-bottom: 1rem;">Additional Services Pricing</h3>
            ${additionalServicesHTML}
          </div>
        ` : ''}

        <div style="display: flex; gap: 0.75rem; margin-top: 2rem;">
          <button onclick="exportSubmission('${submissionId}')" style="flex: 1; padding: 0.75rem; background-color: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
            ðŸ“¥ Export to Excel
          </button>
          <button onclick="this.closest('.modal-overlay').remove()" style="flex: 1; padding: 0.75rem; background-color: #6b7280; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
            Close
          </button>
        </div>
      `;
      
      overlay.className = 'modal-overlay';
      overlay.appendChild(modal);
      document.body.appendChild(overlay);
      
      overlay.onclick = (e) => {
        if (e.target === overlay) overlay.remove();
      };
    }

    function exportSubmission(submissionId) {
      const submission = adminData.submissions.find(s => s.id === submissionId);
      if (!submission) {
        showMessage("Submission not found!", "error");
        return;
      }

      const tender = adminData.tenders.find(t => t.id === submission.tender_id);
      
      const wb = XLSX.utils.book_new();
      
      const summaryData = [
        ['SUBMISSION SUMMARY'],
        [''],
        ['Tender', tender ? tender.name : 'N/A'],
        ['Company Name', submission.company_name || ''],
        ['Contact Name', submission.contact_name || ''],
        ['Contact Email', submission.contact_email || ''],
        ['Contact Phone', submission.contact_phone || ''],
        ['Submitted Date', new Date(submission.submitted_date).toLocaleDateString()],
        ['Total Annual Cost', '$' + (submission.total_annual_cost || '0')],
      ];
      const ws1 = XLSX.utils.aoa_to_sheet(summaryData);
      XLSX.utils.book_append_sheet(wb, ws1, 'Summary');
      
      if (submission.questionnaire_responses && submission.questionnaire_responses.length > 0) {
        const questionnaireData = [['Section', 'Question', 'Answer', 'File URL']];
        submission.questionnaire_responses.forEach(response => {
          const question = tender.questionnaire.find(q => q.id === response.question_id);
          if (question) {
            questionnaireData.push([
              question.section,
              question.question,
              response.answer || '',
              response.file_url || ''
            ]);
          }
        });
        const ws2 = XLSX.utils.aoa_to_sheet(questionnaireData);
        XLSX.utils.book_append_sheet(wb, ws2, 'Questionnaire');
      }
      
      if (submission.core_services_pricing && submission.core_services_pricing.length > 0) {
        const coreData = [['State', 'Site', 'Description', 'Stream', 'Bin Size', 'Frequency', 'Days', 'Monthly Price', 'Annual Price']];
        submission.core_services_pricing.forEach(pricing => {
          const service = tender.core_services[pricing.service_index];
          if (service) {
            coreData.push([
              service.state,
              service.site,
              service.description,
              service.stream,
              service.bin,
              service.frequency,
              service.days,
              '$' + pricing.monthly_price,
              '$' + pricing.annual_price
            ]);
          }
        });
        const ws3 = XLSX.utils.aoa_to_sheet(coreData);
        XLSX.utils.book_append_sheet(wb, ws3, 'Core Services');
      }
      
      if (submission.additional_services_pricing && submission.additional_services_pricing.length > 0) {
        const additionalData = [['State', 'Site', 'Service', 'Price']];
        submission.additional_services_pricing.forEach(pricing => {
          const service = tender.additional_services[pricing.service_index];
          if (service) {
            additionalData.push([
              service.state,
              service.site,
              service.service,
              '$' + pricing.price
            ]);
          }
        });
        const ws4 = XLSX.utils.aoa_to_sheet(additionalData);
        XLSX.utils.book_append_sheet(wb, ws4, 'Additional Services');
      }
      
      const filename = `${submission.company_name || 'Submission'}_${tender ? tender.name : 'Tender'}_${new Date().toISOString().split('T')[0]}.xlsx`;
      XLSX.writeFile(wb, filename);
      
      showMessage("Submission exported successfully! ðŸ“¥", "success");
    }

    function showMessage(message, type) {
      const color = type === "error" ? "#ef4444" : "#10b981";
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed; top: 20px; right: 20px; background-color: ${color};
        color: white; padding: 1rem 1.5rem; border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 10000; font-weight: 500;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', initApp);
    if (document.readyState !== 'loading') initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9aa91a9846f429c5',t:'MTc2NTE2Mzc4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
